{"version":3,"sources":["../../../../../../src/bot/roles-settings/commands/configure-roles/components/select-role.ts"],"sourcesContent":["import { forwardRef, Inject, Injectable } from \"@nestjs/common\";\r\nimport {\r\n\tModal,\r\n\tContext,\r\n\tSlashCommand,\r\n\tSlashCommandContext,\r\n\tCtx,\r\n\tStringSelect,\r\n\tStringSelectContext,\r\n\tRoleSelectContext,\r\n\tSelectedStrings,\r\n\tSelectedChannels,\r\n\tRoleSelect,\r\n\tISelectedRoles,\r\n\tComponentParam,\r\n\tSelectedRoles,\r\n} from \"necord\";\r\nimport {\r\n\tActionRowBuilder,\r\n\tCacheType,\r\n\tChannelSelectMenuBuilder,\r\n\tRoleSelectMenuBuilder,\r\n\tChannelType,\r\n\tChatInputCommandInteraction,\r\n\tEmbedBuilder,\r\n\tModalActionRowComponentBuilder,\r\n\tModalBuilder,\r\n\tModalSubmitInteraction,\r\n\tStringSelectMenuBuilder,\r\n\tStringSelectMenuInteraction,\r\n\tTextInputBuilder,\r\n\tTextInputStyle,\r\n} from \"discord.js\";\r\nimport { BotConfig } from \"@/config\";\r\nimport { ProductProps } from \"@/@shared/sharpify/api\";\r\nimport { formatPrice } from \"@/@shared/lib\";\r\nimport TurndownService from \"turndown\";\r\nimport { ProductCardComponent } from \"@/bot/checkout/components\";\r\nimport { getLocalStoreConfig, Sharpify } from \"@/@shared/sharpify\";\r\nimport { OrderEntity, ProductEntity } from \"@/@shared/db/entities\";\r\nimport { BuildRoleConfigure } from \"./_build-role-configure\";\r\nimport { WrapperType } from \"@/@shared/types\";\r\n\r\n@Injectable()\r\nexport class SelectRole {\r\n\tconstructor(\r\n\t\t@Inject(forwardRef(() => BuildRoleConfigure))\r\n\t\tprivate readonly buildRoleConfigure: WrapperType<BuildRoleConfigure>,\r\n\t) {}\r\n\r\n\t@RoleSelect(\"select_role_on_purchase\")\r\n\tprivate async handleRolelSelected(@Context() [interaction]: RoleSelectContext, @SelectedRoles() selected: ISelectedRoles) {\r\n\t\tconst role = selected.first();\r\n\t\tif (!role) {\r\n\t\t\treturn interaction.reply({\r\n\t\t\t\tcontent: \"Nenhum cargo foi selecionado!\",\r\n\t\t\t\tflags: [\"Ephemeral\"],\r\n\t\t\t});\r\n\t\t}\r\n\t\tif(role.permissions === \"Administrator\") {\r\n\t\t\treturn interaction.reply({\r\n\t\t\t\tcontent: \"Cargos com permissão de Administrador não podem ser selecionados!\",\r\n\t\t\t\tflags: [\"Ephemeral\"],\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst store = await getLocalStoreConfig();\r\n\r\n\t\tconst hasRole = (store.applyRolesSettings || []).some((r) => r.roleId === role.id);\r\n\t\tif (hasRole) {\r\n\t\t\treturn interaction.reply({\r\n\t\t\t\tcontent: \"Cargo já está selecionado!\",\r\n\t\t\t\tflags: [\"Ephemeral\"],\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tawait store.updateRoleSettings([...(store.applyRolesSettings || []), { roleId: role.id }]);\r\n\r\n\t\t// interaction.message.edit(await this.buildRoleConfigure.build());\r\n\t\tinteraction.update(await this.buildRoleConfigure.build() as any);\r\n\t}\r\n\r\n\tcreateSelectChannel({}: {}) {\r\n\t\tconst selectMenu = new RoleSelectMenuBuilder()\r\n\t\t\t.setCustomId(`select_role_on_purchase`)\r\n\t\t\t.setPlaceholder(\"Selecione qual cargo colocar para o cliente...\")\r\n\t\t\t.setMaxValues(1)\r\n\t\t\t.setMinValues(1);\r\n\t\treturn new ActionRowBuilder<RoleSelectMenuBuilder>().addComponents(selectMenu);\r\n\t}\r\n}\r\n"],"names":["SelectRole","handleRolelSelected","interaction","selected","role","first","reply","content","flags","permissions","store","getLocalStoreConfig","hasRole","applyRolesSettings","some","r","roleId","id","updateRoleSettings","update","buildRoleConfigure","build","createSelectChannel","selectMenu","RoleSelectMenuBuilder","setCustomId","setPlaceholder","setMaxValues","setMinValues","ActionRowBuilder","addComponents","BuildRoleConfigure"],"mappings":";;;;+BA4CaA;;;eAAAA;;;wBA5CkC;wBAgBxC;yBAgBA;0BAMuC;oCAEX;uBACP;;;;;;;;;;;;;;;AAGrB,IAAA,AAAMA,aAAN,MAAMA;IAMZ,MACcC,oBAAoB,AAAW,CAACC,YAA+B,EAAE,AAAiBC,QAAwB,EAAE;QACzH,MAAMC,OAAOD,SAASE,KAAK;QAC3B,IAAI,CAACD,MAAM;YACV,OAAOF,YAAYI,KAAK,CAAC;gBACxBC,SAAS;gBACTC,OAAO;oBAAC;iBAAY;YACrB;QACD;QACA,IAAGJ,KAAKK,WAAW,KAAK,iBAAiB;YACxC,OAAOP,YAAYI,KAAK,CAAC;gBACxBC,SAAS;gBACTC,OAAO;oBAAC;iBAAY;YACrB;QACD;QAEA,MAAME,QAAQ,MAAMC,IAAAA,6BAAmB;QAEvC,MAAMC,UAAU,AAACF,CAAAA,MAAMG,kBAAkB,IAAI,EAAE,AAAD,EAAGC,IAAI,CAAC,CAACC,IAAMA,EAAEC,MAAM,KAAKZ,KAAKa,EAAE;QACjF,IAAIL,SAAS;YACZ,OAAOV,YAAYI,KAAK,CAAC;gBACxBC,SAAS;gBACTC,OAAO;oBAAC;iBAAY;YACrB;QACD;QAEA,MAAME,MAAMQ,kBAAkB,CAAC;eAAKR,MAAMG,kBAAkB,IAAI,EAAE;YAAG;gBAAEG,QAAQZ,KAAKa,EAAE;YAAC;SAAE;QAEzF,mEAAmE;QACnEf,YAAYiB,MAAM,CAAC,MAAM,IAAI,CAACC,kBAAkB,CAACC,KAAK;IACvD;IAEAC,oBAAoB,EAAM,EAAE;QAC3B,MAAMC,aAAa,IAAIC,8BAAqB,GAC1CC,WAAW,CAAC,CAAC,uBAAuB,CAAC,EACrCC,cAAc,CAAC,kDACfC,YAAY,CAAC,GACbC,YAAY,CAAC;QACf,OAAO,IAAIC,yBAAgB,GAA0BC,aAAa,CAACP;IACpE;IA5CA,YACC,AACiBH,kBAAmD,CACnE;aADgBA,qBAAAA;IACf;AA0CJ;;;;;;;;;;;;;;iEA5C2BW,sCAAkB"}