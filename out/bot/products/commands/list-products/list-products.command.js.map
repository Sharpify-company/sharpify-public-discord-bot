{"version":3,"sources":["../../../../../src/bot/products/commands/list-products/list-products.command.ts"],"sourcesContent":["import { Injectable, Logger, UseInterceptors } from \"@nestjs/common\";\r\nimport { EmbedBuilder, Integration } from \"discord.js\";\r\nimport { Context, Options, SlashCommand, SlashCommandContext, StringOption } from \"necord\";\r\nimport { ProductEmmbed } from \"./components/_product-emmbed\";\r\nimport { ProductAutocompleteInterceptor } from \"./auto-complete-product.interceptor\";\r\nimport { Sharpify } from \"@/@shared/sharpify\";\r\nimport { BotConfig } from \"@/config\";\r\nimport TurndownService from \"turndown\";\r\nimport { formatPrice } from \"@/@shared/lib\";\r\nimport { SelectSetProductOnChannel } from \"./components/select-set-product-on-channel\";\r\nimport { CreateConfigButtonComponent } from \"./components/create-config-button\";\r\n\r\nconst turndownService = new TurndownService();\r\n\r\nexport class InputDto {\r\n\t@StringOption({\r\n\t\tname: \"titulo\",\r\n\t\tdescription: \"TÃ­tulo do produto\",\r\n\t\trequired: true,\r\n\t\tmax_length: 100,\r\n\t\tautocomplete: true,\r\n\t})\r\n\tproductId!: string;\r\n}\r\n\r\n@Injectable()\r\nexport class ListProductsCommand {\r\n\tconstructor(\r\n\t\tprivate readonly productEmmbed: ProductEmmbed,\r\n\t\tprivate readonly selectSetProductOnChannel: SelectSetProductOnChannel,\r\n\t\tprivate readonly createConfigButtonComponent: CreateConfigButtonComponent,\r\n\t) {}\r\n\r\n\t@UseInterceptors(ProductAutocompleteInterceptor)\r\n\t@SlashCommand({\r\n\t\tname: \"listar-produtos\",\r\n\t\tdescription: \"Cria um componente para listar os seus produtos da Sharpify!\",\r\n\t\tdefaultMemberPermissions: [\"Administrator\"],\r\n\t})\r\n\tpublic async onListProducts(@Context() [interaction]: SlashCommandContext, @Options() { productId }: InputDto) {\r\n\t\tconst product = await Sharpify.api.v1.catalog.product.get({\r\n\t\t\tid: productId,\r\n\t\t\tincludeNonListed: true\r\n\t\t});\r\n\r\n\t\tif (!product.success) {\r\n\t\t\treturn interaction.reply({\r\n\t\t\t\tcontent: `Error ao buscar produto: ${product.errorName}`,\r\n\t\t\t\tflags: [\"Ephemeral\"],\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst { CreateProductConfigButton } = await this.createConfigButtonComponent.createButton({\r\n\t\t\tproductId: product.data.product.id!,\r\n\t\t});\r\n\t\treturn interaction.reply({\r\n\t\t\tembeds: [this.productEmmbed.createEmbbed(product.data.product)],\r\n\t\t\tcomponents: [\r\n        {\r\n          type: 1,\r\n          components: [CreateProductConfigButton],\r\n        },\r\n\t\t\t\tthis.selectSetProductOnChannel.createSelectChannel({\r\n\t\t\t\t\tinteraction,\r\n\t\t\t\t\tproduct: product.data.product,\r\n\t\t\t\t}),\r\n\t\t\t],\r\n\t\t\tflags: [\"Ephemeral\"],\r\n\t\t});\r\n\t}\r\n}\r\n"],"names":["InputDto","ListProductsCommand","turndownService","TurndownService","name","description","required","max_length","autocomplete","onListProducts","interaction","productId","product","Sharpify","api","v1","catalog","get","id","includeNonListed","success","reply","content","errorName","flags","CreateProductConfigButton","createConfigButtonComponent","createButton","data","embeds","productEmmbed","createEmbbed","components","type","selectSetProductOnChannel","createSelectChannel","defaultMemberPermissions"],"mappings":";;;;;;;;;;;QAcaA;eAAAA;;QAYAC;eAAAA;;;wBA1BuC;wBAE8B;+BACpD;gDACiB;0BACtB;iEAEG;2CAEc;oCACE;;;;;;;;;;;;;;;;;;;;AAE5C,MAAMC,kBAAkB,IAAIC,iBAAe;AAEpC,IAAA,AAAMH,WAAN,MAAMA;AASb;;;QAPEI,MAAM;QACNC,aAAa;QACbC,UAAU;QACVC,YAAY;QACZC,cAAc;;;;AAMT,IAAA,AAAMP,sBAAN,MAAMA;IAOZ,MAMaQ,eAAe,AAAW,CAACC,YAAiC,EAAE,AAAW,EAAEC,SAAS,EAAY,EAAE;QAC9G,MAAMC,UAAU,MAAMC,kBAAQ,CAACC,GAAG,CAACC,EAAE,CAACC,OAAO,CAACJ,OAAO,CAACK,GAAG,CAAC;YACzDC,IAAIP;YACJQ,kBAAkB;QACnB;QAEA,IAAI,CAACP,QAAQQ,OAAO,EAAE;YACrB,OAAOV,YAAYW,KAAK,CAAC;gBACxBC,SAAS,CAAC,yBAAyB,EAAEV,QAAQW,SAAS,EAAE;gBACxDC,OAAO;oBAAC;iBAAY;YACrB;QACD;QAEA,MAAM,EAAEC,yBAAyB,EAAE,GAAG,MAAM,IAAI,CAACC,2BAA2B,CAACC,YAAY,CAAC;YACzFhB,WAAWC,QAAQgB,IAAI,CAAChB,OAAO,CAACM,EAAE;QACnC;QACA,OAAOR,YAAYW,KAAK,CAAC;YACxBQ,QAAQ;gBAAC,IAAI,CAACC,aAAa,CAACC,YAAY,CAACnB,QAAQgB,IAAI,CAAChB,OAAO;aAAE;YAC/DoB,YAAY;gBACP;oBACEC,MAAM;oBACND,YAAY;wBAACP;qBAA0B;gBACzC;gBACJ,IAAI,CAACS,yBAAyB,CAACC,mBAAmB,CAAC;oBAClDzB;oBACAE,SAASA,QAAQgB,IAAI,CAAChB,OAAO;gBAC9B;aACA;YACDY,OAAO;gBAAC;aAAY;QACrB;IACD;IA1CA,YACC,AAAiBM,aAA4B,EAC7C,AAAiBI,yBAAoD,EACrE,AAAiBR,2BAAwD,CACxE;aAHgBI,gBAAAA;aACAI,4BAAAA;aACAR,8BAAAA;IACf;AAuCJ;;;;QAnCEtB,MAAM;QACNC,aAAa;QACb+B,0BAA0B;YAAC;SAAgB"}