{"version":3,"sources":["../../../../../src/@shared/db/entities/store-config/store.config.entity.ts"],"sourcesContent":["import { StoreProps } from \"@/@shared/sharpify/api\";\r\nimport { BaseEntity, Column, Entity, PrimaryColumn } from \"typeorm\";\r\n\r\n@Entity(\"storeConfig\")\r\nexport class StoreConfigEntity extends BaseEntity {\r\n\t@PrimaryColumn({ name: \"id\", type: \"text\" })\r\n\tid: string = \"DEFAULT\";\r\n\r\n\t@Column({ name: \"name\", type: \"text\", nullable: false })\r\n\tname!: string;\r\n\r\n\t@Column({ name: \"description\", type: \"text\", nullable: false })\r\n\tdescription!: string;\r\n\r\n\t@Column({ name: \"url\", type: \"text\", nullable: false })\r\n\turl!: string;\r\n\r\n\t@Column({ name: \"image\", type: \"text\", nullable: false })\r\n\timage!: string;\r\n\r\n\t@Column({ name: \"paymentGateways\", type: \"json\", nullable: false, default: \"[]\" })\r\n\tpaymentGateways!: StoreProps.PaymentConfig[];\r\n\r\n\t@Column({ name: \"applyRolesSettings\", type: \"json\", nullable: false, default: \"[]\" })\r\n\tapplyRolesSettings!: StoreConfigEntity.RoleSettings[];\r\n\r\n\t@Column({ name: \"preferences\", type: \"json\", nullable: false, default: \"{}\" })\r\n\tpreferences!: StoreConfigEntity.Preferences;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tstatic createStore(props: StoreProps) {\r\n\t\tconst entity = new StoreConfigEntity();\r\n\t\tentity.updateStoreProps(props);\r\n\t\tentity.applyRolesSettings = [];\r\n\t\treturn entity;\r\n\t}\r\n\r\n\tupdateStoreProps(props: StoreProps) {\r\n\t\tthis.name = props.info.name || \"Sem nome\";\r\n\t\tthis.description = props.info.description || \"Sem descrição\";\r\n\t\tthis.url = props.url || \"https://example.com\";\r\n\t\tthis.image = props.info.image ?? \"https://upload.wikimedia.org/wikipedia/commons/1/14/No_Image_Available.jpg\";\r\n\t\tthis.paymentGateways = props.paymentConfigs || [];\r\n\t}\r\n\r\n\tasync updateProps(props: StoreProps) {\r\n\t\tthis.updateStoreProps(props);\r\n\t\tawait this.save();\r\n\t}\r\n\r\n\tasync updateRoleSettings(roleSettings: StoreConfigEntity.RoleSettings[]) {\r\n\t\tthis.applyRolesSettings = roleSettings;\r\n\t\tawait this.save();\r\n\t}\r\n\r\n\tgetPreferences(): StoreConfigEntity.Preferences {\r\n\t\treturn {\r\n\t\t\t...(this.preferences || {}),\r\n\t\t\tprivateLogSales: this.preferences?.privateLogSales ?? {\r\n\t\t\t\tenabled: this.preferences?.privateLogSales?.enabled ?? false,\r\n\t\t\t\tonlyDiscordSales: this.preferences?.privateLogSales?.onlyDiscordSales ?? false,\r\n\t\t\t\tchannelId: this.preferences?.privateLogSales?.channelId ?? undefined,\r\n\t\t\t},\r\n\t\t\tpublicLogSales: this.preferences?.publicLogSales ?? {\r\n\t\t\t\tenabled: this.preferences?.publicLogSales?.enabled ?? false,\r\n\t\t\t\tonlyDiscordSales: this.preferences?.publicLogSales?.onlyDiscordSales ?? false,\r\n\t\t\t\tchannelId: this.preferences?.publicLogSales?.channelId ?? undefined,\r\n\t\t\t},\r\n\t\t\tfailLog: this.preferences?.failLog ?? {\r\n\t\t\t\tenabled: this.preferences?.failLog?.enabled ?? false,\r\n\t\t\t\tchannelId: this.preferences?.failLog?.channelId ?? undefined,\r\n\t\t\t},\r\n\t\t\tconfirmDelivery: this.preferences?.confirmDelivery ?? {\r\n\t\t\t\tenabled: this.preferences?.confirmDelivery?.enabled ?? false,\r\n\t\t\t\tchannelId: this.preferences?.confirmDelivery?.channelId ?? undefined,\r\n\t\t\t},\r\n\t\t\tfeedbackPublicLog: this.preferences?.feedbackPublicLog ?? {\r\n\t\t\t\tenabled: this.preferences?.feedbackPublicLog?.enabled ?? false,\r\n\t\t\t\tchannelId: this.preferences?.feedbackPublicLog?.channelId ?? undefined,\r\n\t\t\t\tonlyDiscordSales: this.preferences?.feedbackPublicLog?.onlyDiscordSales ?? false,\r\n\t\t\t\tminFeedbackStar: this.preferences?.feedbackPublicLog?.minFeedbackStar ?? 4,\r\n\t\t\t},\r\n\t\t\tfeedbackPrivateLog: this.preferences?.feedbackPrivateLog ?? {\r\n\t\t\t\tenabled: this.preferences?.feedbackPrivateLog?.enabled ?? false,\r\n\t\t\t\tchannelId: this.preferences?.feedbackPrivateLog?.channelId ?? undefined,\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tasync savePreferences(preferences: StoreConfigEntity.Preferences) {\r\n\t\tthis.preferences = preferences;\r\n\t\tawait this.save();\r\n\t}\r\n}\r\n\r\nexport namespace StoreConfigEntity {\r\n\texport type Props = {\r\n\t\tid: string;\r\n\t\tname: string;\r\n\t\tdescription: string;\r\n\t\turl: string;\r\n\t\timage: string;\r\n\t\tpaymentGateways: StoreProps.PaymentConfig[];\r\n\t\tapplyRolesSettings: RoleSettings[];\r\n\t};\r\n\r\n\texport type RoleSettings = {\r\n\t\troleId: string;\r\n\t};\r\n\r\n\texport type Preferences = {\r\n\t\tprivateLogSales: {\r\n\t\t\tenabled: boolean;\r\n\t\t\tchannelId?: string;\r\n\t\t\tonlyDiscordSales?: boolean;\r\n\t\t};\r\n\t\tpublicLogSales: {\r\n\t\t\tenabled: boolean;\r\n\t\t\tchannelId?: string;\r\n\t\t\tonlyDiscordSales?: boolean;\r\n\t\t};\r\n\t\tfailLog: {\r\n\t\t\tenabled: boolean;\r\n\t\t\tchannelId?: string;\r\n\t\t};\r\n\t\tconfirmDelivery: {\r\n\t\t\tenabled: boolean;\r\n\t\t\tchannelId?: string;\r\n\t\t};\r\n\t\tfeedbackPublicLog: {\r\n\t\t\tenabled: boolean;\r\n\t\t\tchannelId?: string;\r\n\t\t\tonlyDiscordSales?: boolean;\r\n\t\t\tminFeedbackStar?: number;\r\n\t\t};\r\n\t\tfeedbackPrivateLog: {\r\n\t\t\tenabled: boolean;\r\n\t\t\tchannelId?: string;\r\n\t\t};\r\n\t};\r\n}\r\n"],"names":["StoreConfigEntity","BaseEntity","createStore","props","entity","updateStoreProps","applyRolesSettings","name","info","description","url","image","paymentGateways","paymentConfigs","updateProps","save","updateRoleSettings","roleSettings","getPreferences","preferences","privateLogSales","enabled","onlyDiscordSales","channelId","undefined","publicLogSales","failLog","confirmDelivery","feedbackPublicLog","minFeedbackStar","feedbackPrivateLog","savePreferences","id","type","nullable","default"],"mappings":"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"}