{"version":3,"sources":["../../../../../../../src/bot/checkout/components/product-card/usecases/add-to-cart/validate-product.ts"],"sourcesContent":["import { Either, failure, success } from \"@/@shared/lib\";\r\nimport { AddToCartUsecase } from \"./_add-to-cart.usecase\";\r\nimport { ProductProps } from \"@/@shared/sharpify/api\";\r\nimport { Sharpify } from \"@/@shared/sharpify\";\r\nimport { InteractionResponse } from \"discord.js\";\r\n\r\nexport async function ValidateProduct({\r\n\tinteraction,\r\n\tproductId,\r\n\tproductItemId,\r\n}: Parameters<typeof AddToCartUsecase.prototype.execute>[0]): Promise<Either<InteractionResponse, ProductProps>> {\r\n\tconst req = await Sharpify.api.v1.catalog.product.get({\r\n\t\tid: productId,\r\n\t\tincludeNonListed: true\r\n\t});\r\n\r\n\tif (!req.success) {\r\n\t\treturn failure(\r\n\t\t\tawait interaction.reply({\r\n\t\t\t\tcontent: `Error ao buscar produto: ${req.errorName}`,\r\n\t\t\t\tflags: [\"Ephemeral\"],\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\tconst { product } = req.data;\r\n\r\n\tconst productItem =\r\n\t\tproduct.settings.viewType === \"NORMAL\" ? product.normalItem : product.dynamicItems.find((v) => v.id === productItemId);\r\n\r\n\tif (!productItem) {\r\n\t\treturn failure(\r\n\t\t\tawait interaction.reply({\r\n\t\t\t\tcontent: `Item inv√°lido.`,\r\n\t\t\t\tflags: [\"Ephemeral\"],\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\tif (productItem.inventory.stockQuantity === null) return success(product);\r\n\tif (productItem.inventory.stockQuantity <= 0) {\r\n\t\treturn failure(\r\n\t\t\tawait interaction.reply({\r\n\t\t\t\tcontent: `Item sem estoque.`,\r\n\t\t\t\tflags: [\"Ephemeral\"],\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\treturn success(product);\r\n}\r\n"],"names":["ValidateProduct","interaction","productId","productItemId","req","Sharpify","api","v1","catalog","product","get","id","includeNonListed","success","failure","reply","content","errorName","flags","data","productItem","settings","viewType","normalItem","dynamicItems","find","v","inventory","stockQuantity"],"mappings":";;;;+BAMsBA;;;eAAAA;;;qBANmB;0BAGhB;AAGlB,eAAeA,gBAAgB,EACrCC,WAAW,EACXC,SAAS,EACTC,aAAa,EAC6C;IAC1D,MAAMC,MAAM,MAAMC,kBAAQ,CAACC,GAAG,CAACC,EAAE,CAACC,OAAO,CAACC,OAAO,CAACC,GAAG,CAAC;QACrDC,IAAIT;QACJU,kBAAkB;IACnB;IAEA,IAAI,CAACR,IAAIS,OAAO,EAAE;QACjB,OAAOC,IAAAA,YAAO,EACb,MAAMb,YAAYc,KAAK,CAAC;YACvBC,SAAS,CAAC,yBAAyB,EAAEZ,IAAIa,SAAS,EAAE;YACpDC,OAAO;gBAAC;aAAY;QACrB;IAEF;IAEA,MAAM,EAAET,OAAO,EAAE,GAAGL,IAAIe,IAAI;IAE5B,MAAMC,cACLX,QAAQY,QAAQ,CAACC,QAAQ,KAAK,WAAWb,QAAQc,UAAU,GAAGd,QAAQe,YAAY,CAACC,IAAI,CAAC,CAACC,IAAMA,EAAEf,EAAE,KAAKR;IAEzG,IAAI,CAACiB,aAAa;QACjB,OAAON,IAAAA,YAAO,EACb,MAAMb,YAAYc,KAAK,CAAC;YACvBC,SAAS,CAAC,cAAc,CAAC;YACzBE,OAAO;gBAAC;aAAY;QACrB;IAEF;IAEA,IAAIE,YAAYO,SAAS,CAACC,aAAa,KAAK,MAAM,OAAOf,IAAAA,YAAO,EAACJ;IACjE,IAAIW,YAAYO,SAAS,CAACC,aAAa,IAAI,GAAG;QAC7C,OAAOd,IAAAA,YAAO,EACb,MAAMb,YAAYc,KAAK,CAAC;YACvBC,SAAS,CAAC,iBAAiB,CAAC;YAC5BE,OAAO;gBAAC;aAAY;QACrB;IAEF;IAEA,OAAOL,IAAAA,YAAO,EAACJ;AAChB"}