{"version":3,"sources":["../../src/workers/handle-external-event.worker.ts"],"sourcesContent":["import { ExternalEventsEntity } from \"@/@shared/db/entities\";\r\nimport { Sharpify } from \"@/@shared/sharpify\";\r\nimport { Injectable, OnModuleInit } from \"@nestjs/common\";\r\nimport { Cron } from \"@nestjs/schedule\";\r\nimport { HandleCheckoutEvent, HandleExternalEventCreatedUsecase, HandleProductEvent } from \"./usecases\";\r\n\r\n@Injectable()\r\nexport class HandleExternalEventWorker {\r\n\tconstructor(private readonly handleExternalEventCreatedUsecase: HandleExternalEventCreatedUsecase) {}\r\n\r\n\t@Cron(\"*/5 * * * * *\")\r\n\thandleCron() {\r\n\t\tthis.execute();\r\n\t}\r\n\r\n\tasync execute() {\r\n\t\tconst pendingEvents = await ExternalEventsEntity.find();\r\n\r\n\t\tfor (const event of pendingEvents) {\r\n\t\t\tawait this.handleExternalEventCreatedUsecase.execute(event);\r\n\t\t}\r\n\t}\r\n}\r\n"],"names":["HandleExternalEventWorker","handleCron","execute","pendingEvents","ExternalEventsEntity","find","event","handleExternalEventCreatedUsecase"],"mappings":";;;;+BAOaA;;;eAAAA;;;0BAPwB;wBAEI;0BACpB;0BACsE;;;;;;;;;;AAGpF,IAAA,AAAMA,4BAAN,MAAMA;IAIZC,aAAa;QACZ,IAAI,CAACC,OAAO;IACb;IAEA,MAAMA,UAAU;QACf,MAAMC,gBAAgB,MAAMC,8BAAoB,CAACC,IAAI;QAErD,KAAK,MAAMC,SAASH,cAAe;YAClC,MAAM,IAAI,CAACI,iCAAiC,CAACL,OAAO,CAACI;QACtD;IACD;IAbA,YAAY,AAAiBC,iCAAoE,CAAE;aAAtEA,oCAAAA;IAAuE;AAcrG"}