{"version":3,"sources":["../../../../../../src/bot/products/commands/list-products/components/create-config-button.ts"],"sourcesContent":["import { forwardRef, Inject, Injectable } from \"@nestjs/common\";\r\nimport {\r\n\tModal,\r\n\tContext,\r\n\tSlashCommand,\r\n\tSlashCommandContext,\r\n\tCtx,\r\n\tModalContext,\r\n\tStringSelect,\r\n\tStringSelectContext,\r\n\tSelectedStrings,\r\n\tButton,\r\n\tComponentParam,\r\n\tModalParam,\r\n} from \"necord\";\r\nimport {\r\n\tActionRowBuilder,\r\n\tButtonBuilder,\r\n\tButtonInteraction,\r\n\tButtonStyle,\r\n\tCacheType,\r\n\tChatInputCommandInteraction,\r\n\tClient,\r\n\tEmbedBuilder,\r\n\tLabelBuilder,\r\n\tMessage,\r\n\tModalActionRowComponentBuilder,\r\n\tModalBuilder,\r\n\tModalSubmitInteraction,\r\n\tTextChannel,\r\n\tTextInputBuilder,\r\n\tTextInputStyle,\r\n} from \"discord.js\";\r\nimport { BotConfig } from \"@/config\";\r\nimport { ProductProps } from \"@/@shared/sharpify/api\";\r\nimport { dotEnv, formatPrice } from \"@/@shared/lib\";\r\nimport TurndownService from \"turndown\";\r\nimport { DiscordUserEntity, EmojiEntity, OrderEntity, ProductEntity } from \"@/@shared/db/entities\";\r\n\r\nimport { WrapperType } from \"@/@shared/types\";\r\nimport { Sharpify } from \"@/@shared/sharpify\";\r\nimport { HandleDiscordMemberNotFound } from \"@/@shared/handlers\";\r\nimport { FindEmojiHelper } from \"@/@shared/helpers\";\r\nimport { MemoryCreateConfig } from \"../memory-create-config\";\r\n\r\n@Injectable()\r\nexport class CreateConfigButtonComponent {\r\n\tconstructor(@Inject(Client) private readonly client: Client) {}\r\n\r\n\t@Modal(\"config_product_creation_modal:productId\")\r\n\tpublic async onModalSubmit(@Ctx() [interaction]: ModalContext, @ModalParam(\"productId\") productId: string) {\r\n\t\tconst color = interaction.fields.getTextInputValue(\"colorInput\");\r\n\r\n\t\tif (!/^#([A-Fa-f0-9]{1,6})$/.test(color)) {\r\n\t\t\treturn interaction.reply({\r\n\t\t\t\tcontent: `❌ Cor inválida! Por favor, insira um valor hexadecimal válido. Exemplo: #338bff. Com 6 caracteres após o #.`,\r\n\t\t\t\tflags: [\"Ephemeral\"],\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tMemoryCreateConfig.set(productId, {\r\n\t\t\tcolor,\r\n\t\t});\r\n\r\n\t\tawait interaction?.reply({\r\n\t\t\tcontent: `✅ Configuração criada com sucesso!\\nCor da Badge: ${color}`,\r\n\t\t\tflags: [\"Ephemeral\"],\r\n\t\t});\r\n\t}\r\n\r\n\t@Button(\"config_product_creation:productId\")\r\n\tprivate async handleButtonClicked(\r\n\t\t@Context() [interaction]: [ButtonInteraction],\r\n\t\t@ComponentParam(\"productId\") productId: string,\r\n\t) {\r\n\r\n\t\tconst Config = MemoryCreateConfig.get(productId);\r\n\r\n\t\tconst modal = new ModalBuilder()\r\n\t\t\t.setCustomId(`config_product_creation_modal${productId}`)\r\n\t\t\t.setTitle(`Configurar criação do produto`);\r\n\r\n\t\tconst badgeColor = new TextInputBuilder()\r\n\t\t\t.setCustomId(\"colorInput\")\r\n\t\t\t.setLabel(`Cor da Badge (Hexadecimal)`)\r\n\t\t\t.setStyle(TextInputStyle.Short)\r\n\t\t\t.setMinLength(1)\r\n\t\t\t.setMaxLength(40)\r\n\t\t\t.setRequired(true);\r\n\t\tbadgeColor.setValue(Config?.color || dotEnv.DEFAULT_COLOR || \"#338bff\");\r\n\r\n\t\tmodal.setComponents(new ActionRowBuilder<ModalActionRowComponentBuilder>().addComponents([badgeColor]));\r\n\r\n\t\tawait interaction.showModal(modal);\r\n\t}\r\n\r\n\tasync createButton({ productId }: { productId: string }) {\r\n\t\tconst devEmoji = await FindEmojiHelper({ client: this.client, name: \"Sharpify_dev\" });\r\n\r\n\t\tconst CreateProductConfigButton = new ButtonBuilder()\r\n\t\t\t.setCustomId(`config_product_creation${productId}`) // unique ID to handle clicks\r\n\t\t\t.setLabel(`Configurar criação do produto`) // text on the button\r\n\t\t\t.setStyle(ButtonStyle.Secondary); // gray button, like in the image\r\n\t\tdevEmoji && CreateProductConfigButton.setEmoji({ id: devEmoji.id });\r\n\t\treturn { CreateProductConfigButton };\r\n\t}\r\n}\r\n"],"names":["CreateConfigButtonComponent","onModalSubmit","interaction","productId","color","fields","getTextInputValue","test","reply","content","flags","MemoryCreateConfig","set","handleButtonClicked","Config","get","modal","ModalBuilder","setCustomId","setTitle","badgeColor","TextInputBuilder","setLabel","setStyle","TextInputStyle","Short","setMinLength","setMaxLength","setRequired","setValue","dotEnv","DEFAULT_COLOR","setComponents","ActionRowBuilder","addComponents","showModal","createButton","devEmoji","FindEmojiHelper","client","name","CreateProductConfigButton","ButtonBuilder","ButtonStyle","Secondary","setEmoji","id"],"mappings":";;;;+BA8CaA;;;eAAAA;;;wBA9CkC;wBAcxC;yBAkBA;qBAG6B;yBAOJ;oCACG;;;;;;;;;;;;;;;AAG5B,IAAA,AAAMA,8BAAN,MAAMA;IAGZ,MACaC,cAAc,AAAO,CAACC,YAA0B,EAAE,AAAyBC,SAAiB,EAAE;QAC1G,MAAMC,QAAQF,YAAYG,MAAM,CAACC,iBAAiB,CAAC;QAEnD,IAAI,CAAC,wBAAwBC,IAAI,CAACH,QAAQ;YACzC,OAAOF,YAAYM,KAAK,CAAC;gBACxBC,SAAS,CAAC,2GAA2G,CAAC;gBACtHC,OAAO;oBAAC;iBAAY;YACrB;QACD;QAEAC,sCAAkB,CAACC,GAAG,CAACT,WAAW;YACjCC;QACD;QAEA,MAAMF,aAAaM,MAAM;YACxBC,SAAS,CAAC,kDAAkD,EAAEL,OAAO;YACrEM,OAAO;gBAAC;aAAY;QACrB;IACD;IAEA,MACcG,oBACb,AAAW,CAACX,YAAiC,EAC7C,AAA6BC,SAAiB,EAC7C;QAED,MAAMW,SAASH,sCAAkB,CAACI,GAAG,CAACZ;QAEtC,MAAMa,QAAQ,IAAIC,qBAAY,GAC5BC,WAAW,CAAC,CAAC,6BAA6B,EAAEf,WAAW,EACvDgB,QAAQ,CAAC,CAAC,6BAA6B,CAAC;QAE1C,MAAMC,aAAa,IAAIC,yBAAgB,GACrCH,WAAW,CAAC,cACZI,QAAQ,CAAC,CAAC,0BAA0B,CAAC,EACrCC,QAAQ,CAACC,uBAAc,CAACC,KAAK,EAC7BC,YAAY,CAAC,GACbC,YAAY,CAAC,IACbC,WAAW,CAAC;QACdR,WAAWS,QAAQ,CAACf,QAAQV,SAAS0B,WAAM,CAACC,aAAa,IAAI;QAE7Df,MAAMgB,aAAa,CAAC,IAAIC,yBAAgB,GAAmCC,aAAa,CAAC;YAACd;SAAW;QAErG,MAAMlB,YAAYiC,SAAS,CAACnB;IAC7B;IAEA,MAAMoB,aAAa,EAAEjC,SAAS,EAAyB,EAAE;QACxD,MAAMkC,WAAW,MAAMC,IAAAA,wBAAe,EAAC;YAAEC,QAAQ,IAAI,CAACA,MAAM;YAAEC,MAAM;QAAe;QAEnF,MAAMC,4BAA4B,IAAIC,sBAAa,GACjDxB,WAAW,CAAC,CAAC,uBAAuB,EAAEf,WAAW,EAAE,6BAA6B;SAChFmB,QAAQ,CAAC,CAAC,6BAA6B,CAAC,EAAE,qBAAqB;SAC/DC,QAAQ,CAACoB,oBAAW,CAACC,SAAS,GAAG,iCAAiC;QACpEP,YAAYI,0BAA0BI,QAAQ,CAAC;YAAEC,IAAIT,SAASS,EAAE;QAAC;QACjE,OAAO;YAAEL;QAA0B;IACpC;IA1DA,YAAY,AAAiCF,MAAc,CAAE;aAAhBA,SAAAA;IAAiB;AA2D/D"}