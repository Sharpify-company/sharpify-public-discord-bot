{"version":3,"sources":["../../../../../../src/bot/checkout/components/checkout-card/components/select-cart-item.ts"],"sourcesContent":["import { forwardRef, Inject, Injectable } from \"@nestjs/common\";\r\nimport {\r\n\tModal,\r\n\tContext,\r\n\tSlashCommand,\r\n\tSlashCommandContext,\r\n\tCtx,\r\n\tModalContext,\r\n\tStringSelect,\r\n\tStringSelectContext,\r\n\tSelectedStrings,\r\n} from \"necord\";\r\nimport {\r\n\tActionRowBuilder,\r\n\tCacheType,\r\n\tChatInputCommandInteraction,\r\n\tClient,\r\n\tEmbedBuilder,\r\n\tMessage,\r\n\tModalActionRowComponentBuilder,\r\n\tModalBuilder,\r\n\tModalSubmitInteraction,\r\n\tStringSelectMenuBuilder,\r\n\tTextChannel,\r\n\tTextInputBuilder,\r\n\tTextInputStyle,\r\n} from \"discord.js\";\r\nimport { BotConfig } from \"@/config\";\r\nimport { ProductProps } from \"@/@shared/sharpify/api\";\r\nimport { formatPrice } from \"@/@shared/lib\";\r\nimport TurndownService from \"turndown\";\r\nimport { DiscordUserEntity, ProductEntity } from \"@/@shared/db/entities\";\r\nimport { ValidateDatabaseCartItemsHelper } from \"../../../helpers\";\r\nimport { formatCheckoutCartItemNameHelper, getCheckoutCartItemsHelper } from \"../helper\";\r\nimport { SectionManagerHandler } from \"../section-manager\";\r\nimport { WrapperType } from \"@/@shared/types\";\r\n\r\n@Injectable()\r\nexport class SelectCartItemComponent {\r\n\tconstructor(\r\n\t\t@Inject(Client) private readonly client: Client,\r\n\t\t@Inject(forwardRef(() => SectionManagerHandler))\r\n\t\tprivate readonly sectionManagerHandler: WrapperType<SectionManagerHandler>,\r\n\t) {}\r\n\r\n\t@StringSelect(\"cart_item_select\")\r\n\tprivate async handleItemSelected(@Context() [interaction]: StringSelectContext, @SelectedStrings() selected: string[]) {\r\n\t\tconst [productId, productItemId] = selected.at(0)?.split(\":\") as string[];\r\n\r\n\t\tconst result = await this.sectionManagerHandler.setSection({\r\n\t\t\tdiscordUserId: interaction.user.id,\r\n\t\t\tsection: \"CART_ITEM\",\r\n\t\t\tproductId,\r\n\t\t\titemId: productItemId,\r\n\t\t});\r\n\r\n\t\tawait interaction.deferUpdate();\r\n\t\tawait interaction.message.edit(result as any);\r\n\t}\r\n\r\n\tasync createSelect({ discordUserId, defaultItemId }: { discordUserId: string; defaultItemId?: string }) {\r\n\t\tawait ValidateDatabaseCartItemsHelper({ discordUserId });\r\n\r\n\t\tconst checkoutCartItems = await getCheckoutCartItemsHelper({ discordUserId });\r\n\r\n\t\tconst options = checkoutCartItems.map((item) => ({\r\n\t\t\tlabel: formatCheckoutCartItemNameHelper(item).slice(0, 100),\r\n\t\t\tdescription: `ðŸ’¸ Valor: ${formatPrice(item.item.pricing.price)} | ðŸ“¦ Estoque ${item.item.inventory.stockQuantity === null ? \"Ilimitado\" : `${item.item.inventory.stockQuantity} unidades`}`,\r\n\t\t\tvalue: `${item.product.id}:${item.item.id}`,\r\n\t\t\temoji: \"ðŸ›’\",\r\n\t\t\tdefault: defaultItemId ? item.item.id === defaultItemId : false,\r\n\t\t}));\r\n\r\n\t\tconst selectMenu = new StringSelectMenuBuilder()\r\n\t\t\t.setCustomId(`cart_item_select`)\r\n\t\t\t.setPlaceholder(\"ðŸ“¦ Edite a quantidade ou remova o item do carrinho\")\r\n\t\t\t.addOptions(options)\r\n\r\n\t\tconst row = new ActionRowBuilder<StringSelectMenuBuilder>().addComponents(selectMenu);\r\n\r\n\t\treturn { row };\r\n\t}\r\n}\r\n"],"names":["SelectCartItemComponent","handleItemSelected","interaction","selected","productId","productItemId","at","split","result","sectionManagerHandler","setSection","discordUserId","user","id","section","itemId","deferUpdate","message","edit","createSelect","defaultItemId","ValidateDatabaseCartItemsHelper","checkoutCartItems","getCheckoutCartItemsHelper","options","map","item","label","formatCheckoutCartItemNameHelper","slice","description","formatPrice","pricing","price","inventory","stockQuantity","value","product","emoji","default","selectMenu","StringSelectMenuBuilder","setCustomId","setPlaceholder","addOptions","row","ActionRowBuilder","addComponents","client","SectionManagerHandler"],"mappings":";;;;+BAsCaA;;;eAAAA;;;wBAtCkC;wBAWxC;yBAeA;qBAGqB;yBAGoB;wBAC6B;gCACvC;uBACV;;;;;;;;;;;;;;;AAGrB,IAAA,AAAMA,0BAAN,MAAMA;IAOZ,MACcC,mBAAmB,AAAW,CAACC,YAAiC,EAAE,AAAmBC,QAAkB,EAAE;QACtH,MAAM,CAACC,WAAWC,cAAc,GAAGF,SAASG,EAAE,CAAC,IAAIC,MAAM;QAEzD,MAAMC,SAAS,MAAM,IAAI,CAACC,qBAAqB,CAACC,UAAU,CAAC;YAC1DC,eAAeT,YAAYU,IAAI,CAACC,EAAE;YAClCC,SAAS;YACTV;YACAW,QAAQV;QACT;QAEA,MAAMH,YAAYc,WAAW;QAC7B,MAAMd,YAAYe,OAAO,CAACC,IAAI,CAACV;IAChC;IAEA,MAAMW,aAAa,EAAER,aAAa,EAAES,aAAa,EAAqD,EAAE;QACvG,MAAMC,IAAAA,wCAA+B,EAAC;YAAEV;QAAc;QAEtD,MAAMW,oBAAoB,MAAMC,IAAAA,kCAA0B,EAAC;YAAEZ;QAAc;QAE3E,MAAMa,UAAUF,kBAAkBG,GAAG,CAAC,CAACC,OAAU,CAAA;gBAChDC,OAAOC,IAAAA,wCAAgC,EAACF,MAAMG,KAAK,CAAC,GAAG;gBACvDC,aAAa,CAAC,UAAU,EAAEC,IAAAA,gBAAW,EAACL,KAAKA,IAAI,CAACM,OAAO,CAACC,KAAK,EAAE,cAAc,EAAEP,KAAKA,IAAI,CAACQ,SAAS,CAACC,aAAa,KAAK,OAAO,cAAc,GAAGT,KAAKA,IAAI,CAACQ,SAAS,CAACC,aAAa,CAAC,SAAS,CAAC,EAAE;gBAC3LC,OAAO,GAAGV,KAAKW,OAAO,CAACxB,EAAE,CAAC,CAAC,EAAEa,KAAKA,IAAI,CAACb,EAAE,EAAE;gBAC3CyB,OAAO;gBACPC,SAASnB,gBAAgBM,KAAKA,IAAI,CAACb,EAAE,KAAKO,gBAAgB;YAC3D,CAAA;QAEA,MAAMoB,aAAa,IAAIC,gCAAuB,GAC5CC,WAAW,CAAC,CAAC,gBAAgB,CAAC,EAC9BC,cAAc,CAAC,sDACfC,UAAU,CAACpB;QAEb,MAAMqB,MAAM,IAAIC,yBAAgB,GAA4BC,aAAa,CAACP;QAE1E,OAAO;YAAEK;QAAI;IACd;IA1CA,YACC,AAAiCG,MAAc,EAC/C,AACiBvC,qBAAyD,CACzE;aAHgCuC,SAAAA;aAEhBvC,wBAAAA;IACf;AAuCJ;;;;;;;;;;;;;;;iEAzC2BwC,qCAAqB"}