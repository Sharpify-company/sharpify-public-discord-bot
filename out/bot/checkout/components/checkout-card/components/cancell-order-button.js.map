{"version":3,"sources":["../../../../../../src/bot/checkout/components/checkout-card/components/cancell-order-button.ts"],"sourcesContent":["import { forwardRef, Inject, Injectable } from \"@nestjs/common\";\r\nimport {\r\n\tModal,\r\n\tContext,\r\n\tSlashCommand,\r\n\tSlashCommandContext,\r\n\tCtx,\r\n\tModalContext,\r\n\tStringSelect,\r\n\tStringSelectContext,\r\n\tSelectedStrings,\r\n\tButton,\r\n\tComponentParam,\r\n\tModalParam,\r\n} from \"necord\";\r\nimport {\r\n\tActionRowBuilder,\r\n\tButtonBuilder,\r\n\tButtonInteraction,\r\n\tButtonStyle,\r\n\tCacheType,\r\n\tChatInputCommandInteraction,\r\n\tClient,\r\n\tEmbedBuilder,\r\n\tLabelBuilder,\r\n\tMessage,\r\n\tModalActionRowComponentBuilder,\r\n\tModalBuilder,\r\n\tModalSubmitInteraction,\r\n\tTextChannel,\r\n\tTextInputBuilder,\r\n\tTextInputStyle,\r\n} from \"discord.js\";\r\nimport { BotConfig } from \"@/config\";\r\nimport { ProductProps } from \"@/@shared/sharpify/api\";\r\nimport { formatPrice } from \"@/@shared/lib\";\r\nimport TurndownService from \"turndown\";\r\nimport { DiscordUserEntity, EmojiEntity, ProductEntity } from \"@/@shared/db/entities\";\r\nimport { ValidateDatabaseCartItemsHelper } from \"../../../helpers\";\r\nimport { formatCheckoutCartItemNameHelper, getCheckoutCartItemsHelper } from \"../helper\";\r\nimport { SectionManagerHandler } from \"../section-manager\";\r\nimport { WrapperType } from \"@/@shared/types\";\r\nimport { HandleOrderCancelledUsecase, RemoveFromCartUsecase } from \"../usecases\";\r\nimport { HandleDiscordMemberNotFound } from \"@/@shared/handlers\";\r\nimport { FindEmojiHelper } from \"@/@shared/helpers\";\r\n\r\n@Injectable()\r\nexport class CancelOrderButtonComponent {\r\n\tconstructor(\r\n\t\t@Inject(Client) private readonly client: Client,\r\n\t\t@Inject(forwardRef(() => SectionManagerHandler))\r\n\t\tprivate readonly sectionManagerHandler: WrapperType<SectionManagerHandler>,\r\n\t\tprivate readonly HandleOrderCancelledUsecase: HandleOrderCancelledUsecase,\r\n\t) {}\r\n\r\n\t@Button(\"cancel_order\")\r\n\tprivate async handleButtonClicked(@Context() [interaction]: [ButtonInteraction]) {\r\n\t\tawait interaction.deferReply({ flags: \"Ephemeral\" });\r\n\r\n\t\tconst discordUser = await DiscordUserEntity.findOneBy({ id: interaction.user.id });\r\n\t\tif (!discordUser) return await HandleDiscordMemberNotFound({ interaction });\r\n\t\t\r\n\t\tawait interaction.editReply({\r\n\t\t\tcontent: \"âœ… | Seu pedido foi cancelado com sucesso.\",\r\n\t\t\tcomponents: [],\r\n\t\t\tembeds: [],\r\n\t\t});\r\n\t\tawait this.HandleOrderCancelledUsecase.execute({ discordUserId: discordUser.id });\r\n\r\n\r\n\t}\r\n\r\n\tasync createButton() {\r\n\t\tconst cancelEmoji = await FindEmojiHelper({ client: this.client, name: \"Sharpify_recusar\" });\r\n\r\n\t\tconst CancelCartButton = new ButtonBuilder()\r\n\t\t\t.setCustomId(`cancel_order`)\r\n\t\t\t.setLabel(\"Cancelar compra\")\r\n\t\t\t.setStyle(ButtonStyle.Secondary);\r\n\t\tcancelEmoji && CancelCartButton.setEmoji({ id: cancelEmoji.id });\r\n\t\treturn { CancelCartButton };\r\n\t}\r\n}\r\n"],"names":["CancelOrderButtonComponent","handleButtonClicked","interaction","deferReply","flags","discordUser","DiscordUserEntity","findOneBy","id","user","HandleDiscordMemberNotFound","editReply","content","components","embeds","HandleOrderCancelledUsecase","execute","discordUserId","createButton","cancelEmoji","FindEmojiHelper","client","name","CancelCartButton","ButtonBuilder","setCustomId","setLabel","setStyle","ButtonStyle","Secondary","setEmoji","sectionManagerHandler","SectionManagerHandler"],"mappings":";;;;+BA+CaA;;;eAAAA;;;wBA/CkC;wBAcxC;yBAkBA;0BAKuD;gCAGxB;uBACV;0BACuC;0BACvB;yBACZ;;;;;;;;;;;;;;;AAGzB,IAAA,AAAMA,6BAAN,MAAMA;IAQZ,MACcC,oBAAoB,AAAW,CAACC,YAAiC,EAAE;QAChF,MAAMA,YAAYC,UAAU,CAAC;YAAEC,OAAO;QAAY;QAElD,MAAMC,cAAc,MAAMC,2BAAiB,CAACC,SAAS,CAAC;YAAEC,IAAIN,YAAYO,IAAI,CAACD,EAAE;QAAC;QAChF,IAAI,CAACH,aAAa,OAAO,MAAMK,IAAAA,qCAA2B,EAAC;YAAER;QAAY;QAEzE,MAAMA,YAAYS,SAAS,CAAC;YAC3BC,SAAS;YACTC,YAAY,EAAE;YACdC,QAAQ,EAAE;QACX;QACA,MAAM,IAAI,CAACC,2BAA2B,CAACC,OAAO,CAAC;YAAEC,eAAeZ,YAAYG,EAAE;QAAC;IAGhF;IAEA,MAAMU,eAAe;QACpB,MAAMC,cAAc,MAAMC,IAAAA,wBAAe,EAAC;YAAEC,QAAQ,IAAI,CAACA,MAAM;YAAEC,MAAM;QAAmB;QAE1F,MAAMC,mBAAmB,IAAIC,sBAAa,GACxCC,WAAW,CAAC,CAAC,YAAY,CAAC,EAC1BC,QAAQ,CAAC,mBACTC,QAAQ,CAACC,oBAAW,CAACC,SAAS;QAChCV,eAAeI,iBAAiBO,QAAQ,CAAC;YAAEtB,IAAIW,YAAYX,EAAE;QAAC;QAC9D,OAAO;YAAEe;QAAiB;IAC3B;IAjCA,YACC,AAAiCF,MAAc,EAC/C,AACiBU,qBAAyD,EAC1E,AAAiBhB,2BAAwD,CACxE;aAJgCM,SAAAA;aAEhBU,wBAAAA;aACAhB,8BAAAA;IACf;AA6BJ;;;;;;;;;;;;;iEAhC2BiB,qCAAqB"}