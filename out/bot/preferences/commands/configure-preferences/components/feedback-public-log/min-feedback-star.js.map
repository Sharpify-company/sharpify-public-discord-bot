{"version":3,"sources":["../../../../../../../src/bot/preferences/commands/configure-preferences/components/feedback-public-log/min-feedback-star.ts"],"sourcesContent":["import { forwardRef, Inject, Injectable } from \"@nestjs/common\";\r\nimport {\r\n\tModal,\r\n\tContext,\r\n\tSlashCommand,\r\n\tSlashCommandContext,\r\n\tCtx,\r\n\tModalContext,\r\n\tStringSelect,\r\n\tStringSelectContext,\r\n\tSelectedStrings,\r\n\tButton,\r\n\tComponentParam,\r\n\tModalParam,\r\n} from \"necord\";\r\nimport {\r\n\tActionRowBuilder,\r\n\tButtonBuilder,\r\n\tButtonInteraction,\r\n\tButtonStyle,\r\n\tCacheType,\r\n\tChatInputCommandInteraction,\r\n\tClient,\r\n\tEmbedBuilder,\r\n\tLabelBuilder,\r\n\tMessage,\r\n\tModalActionRowComponentBuilder,\r\n\tModalBuilder,\r\n\tModalSubmitInteraction,\r\n\tStringSelectMenuBuilder,\r\n\tTextChannel,\r\n\tTextInputBuilder,\r\n\tTextInputStyle,\r\n} from \"discord.js\";\r\nimport { BotConfig } from \"@/config\";\r\nimport { ProductProps } from \"@/@shared/sharpify/api\";\r\nimport { formatPrice } from \"@/@shared/lib\";\r\nimport TurndownService from \"turndown\";\r\nimport { DiscordUserEntity, EmojiEntity, ProductEntity } from \"@/@shared/db/entities\";\r\n\r\nimport { WrapperType } from \"@/@shared/types\";\r\n\r\nimport { HandleDiscordMemberNotFound } from \"@/@shared/handlers\";\r\nimport { FindEmojiHelper } from \"@/@shared/helpers\";\r\nimport { getLocalStoreConfig, Sharpify } from \"@/@shared/sharpify\";\r\nimport { BuildFeedbackPublicLogSection } from \"./_build-feedback-public-log-section\";\r\n\r\n@Injectable()\r\nexport class MinFeedbackStarButton {\r\n\tconstructor(\r\n\t\t@Inject(Client) private readonly client: Client,\r\n\t\t@Inject(forwardRef(() => BuildFeedbackPublicLogSection))\r\n\t\tprivate readonly buildFeedbackPublicLogSection: WrapperType<BuildFeedbackPublicLogSection>,\r\n\t) {}\r\n\r\n\t@Modal(\"edit_min_feedback_star_public_log_modal\")\r\n\tpublic async onModalSubmit(@Ctx() [interaction]: ModalContext) {\r\n\t\tconst discordUser = await DiscordUserEntity.findOneBy({ id: interaction.user.id });\r\n\t\tif (!discordUser) return await HandleDiscordMemberNotFound({ interaction });\r\n\r\n\t\tconst minStar = parseInt(interaction.fields.getTextInputValue(\"minStar\"));\r\n\t\tif (isNaN(minStar) || minStar < 1 || minStar > 5) {\r\n\t\t\treturn await interaction.reply({\r\n\t\t\t\tcontent: `Por favor, insira um número válido entre 1 e 5 para a estrela mínima.`,\r\n\t\t\t\tephemeral: true,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst store = await getLocalStoreConfig();\r\n\t\tconst preferences = store.getPreferences();\r\n\t\tpreferences.feedbackPublicLog.minFeedbackStar = minStar;\r\n\t\tawait store.savePreferences(preferences);\r\n\r\n\t\tawait interaction.reply({\r\n\t\t\tcontent: `Estrela mínima de feedback público atualizada para ${minStar}⭐ com sucesso! Quando um feedback for recebido com pelo menos ${minStar}⭐, ele não registrado em nenhum canal.`,\r\n            flags: [\"Ephemeral\"]\r\n\t\t});\r\n\t}\r\n\r\n\t@Button(\"edit_min_feedback_star_public_log\")\r\n\tprivate async button(@Context() [interaction]: [ButtonInteraction]) {\r\n\t\tconst minFeedbackStar = (await getLocalStoreConfig()).getPreferences().feedbackPublicLog.minFeedbackStar || 4;\r\n\r\n\t\tconst modal = new ModalBuilder()\r\n\t\t\t.setCustomId(`edit_min_feedback_star_public_log_modal`)\r\n\t\t\t.setTitle(`Aplicar Estrela Mínima de Feedback. 1⭐ - 5⭐`)\r\n\r\n\t\tconst starInput = new TextInputBuilder()\r\n\t\t\t.setCustomId(\"minStar\")\r\n\t\t\t.setLabel(`Insira o número mínimo de estrelas`)\r\n\t\t\t.setStyle(TextInputStyle.Short)\r\n            .setValue(minFeedbackStar.toString())\r\n\t\t\t.setMinLength(1)\r\n\t\t\t.setMaxLength(50)\r\n\t\t\t.setRequired(true);\r\n\r\n\t\tmodal.setComponents(new ActionRowBuilder<ModalActionRowComponentBuilder>().addComponents([starInput]));\r\n\r\n\t\tawait interaction.showModal(modal);\r\n\t}\r\n\r\n\tasync createButton() {\r\n\t\tconst minFeedbackStar = (await getLocalStoreConfig()).getPreferences().feedbackPublicLog.minFeedbackStar || 4;\r\n\r\n\t\tlet minFeedbackStarButton = new ButtonBuilder()\r\n\t\t\t.setCustomId(\"edit_min_feedback_star_public_log\")\r\n\t\t\t.setLabel(`Editar estrela mínima | Atual: ${minFeedbackStar}⭐`)\r\n\t\t\t.setStyle(ButtonStyle.Secondary);\r\n\r\n\t\treturn { minFeedbackStarButton };\r\n\t}\r\n}\r\n"],"names":["MinFeedbackStarButton","onModalSubmit","interaction","discordUser","DiscordUserEntity","findOneBy","id","user","HandleDiscordMemberNotFound","minStar","parseInt","fields","getTextInputValue","isNaN","reply","content","ephemeral","store","getLocalStoreConfig","preferences","getPreferences","feedbackPublicLog","minFeedbackStar","savePreferences","flags","button","modal","ModalBuilder","setCustomId","setTitle","starInput","TextInputBuilder","setLabel","setStyle","TextInputStyle","Short","setValue","toString","setMinLength","setMaxLength","setRequired","setComponents","ActionRowBuilder","addComponents","showModal","createButton","minFeedbackStarButton","ButtonBuilder","ButtonStyle","Secondary","client","buildFeedbackPublicLogSection","BuildFeedbackPublicLogSection"],"mappings":";;;;+BAgDaA;;;eAAAA;;;wBAhDkC;wBAcxC;yBAmBA;0BAKuD;uBAElC;0BAEgB;0BAEE;+CACA;;;;;;;;;;;;;;;AAGvC,IAAA,AAAMA,wBAAN,MAAMA;IAOZ,MACaC,cAAc,AAAO,CAACC,YAA0B,EAAE;QAC9D,MAAMC,cAAc,MAAMC,2BAAiB,CAACC,SAAS,CAAC;YAAEC,IAAIJ,YAAYK,IAAI,CAACD,EAAE;QAAC;QAChF,IAAI,CAACH,aAAa,OAAO,MAAMK,IAAAA,qCAA2B,EAAC;YAAEN;QAAY;QAEzE,MAAMO,UAAUC,SAASR,YAAYS,MAAM,CAACC,iBAAiB,CAAC;QAC9D,IAAIC,MAAMJ,YAAYA,UAAU,KAAKA,UAAU,GAAG;YACjD,OAAO,MAAMP,YAAYY,KAAK,CAAC;gBAC9BC,SAAS,CAAC,qEAAqE,CAAC;gBAChFC,WAAW;YACZ;QACD;QAEA,MAAMC,QAAQ,MAAMC,IAAAA,6BAAmB;QACvC,MAAMC,cAAcF,MAAMG,cAAc;QACxCD,YAAYE,iBAAiB,CAACC,eAAe,GAAGb;QAChD,MAAMQ,MAAMM,eAAe,CAACJ;QAE5B,MAAMjB,YAAYY,KAAK,CAAC;YACvBC,SAAS,CAAC,mDAAmD,EAAEN,QAAQ,8DAA8D,EAAEA,QAAQ,sCAAsC,CAAC;YAC7Ke,OAAO;gBAAC;aAAY;QAC9B;IACD;IAEA,MACcC,OAAO,AAAW,CAACvB,YAAiC,EAAE;QACnE,MAAMoB,kBAAkB,AAAC,CAAA,MAAMJ,IAAAA,6BAAmB,GAAC,EAAGE,cAAc,GAAGC,iBAAiB,CAACC,eAAe,IAAI;QAE5G,MAAMI,QAAQ,IAAIC,qBAAY,GAC5BC,WAAW,CAAC,CAAC,uCAAuC,CAAC,EACrDC,QAAQ,CAAC,CAAC,2CAA2C,CAAC;QAExD,MAAMC,YAAY,IAAIC,yBAAgB,GACpCH,WAAW,CAAC,WACZI,QAAQ,CAAC,CAAC,kCAAkC,CAAC,EAC7CC,QAAQ,CAACC,uBAAc,CAACC,KAAK,EACpBC,QAAQ,CAACd,gBAAgBe,QAAQ,IAC1CC,YAAY,CAAC,GACbC,YAAY,CAAC,IACbC,WAAW,CAAC;QAEdd,MAAMe,aAAa,CAAC,IAAIC,yBAAgB,GAAmCC,aAAa,CAAC;YAACb;SAAU;QAEpG,MAAM5B,YAAY0C,SAAS,CAAClB;IAC7B;IAEA,MAAMmB,eAAe;QACpB,MAAMvB,kBAAkB,AAAC,CAAA,MAAMJ,IAAAA,6BAAmB,GAAC,EAAGE,cAAc,GAAGC,iBAAiB,CAACC,eAAe,IAAI;QAE5G,IAAIwB,wBAAwB,IAAIC,sBAAa,GAC3CnB,WAAW,CAAC,qCACZI,QAAQ,CAAC,CAAC,+BAA+B,EAAEV,gBAAgB,CAAC,CAAC,EAC7DW,QAAQ,CAACe,oBAAW,CAACC,SAAS;QAEhC,OAAO;YAAEH;QAAsB;IAChC;IA7DA,YACC,AAAiCI,MAAc,EAC/C,AACiBC,6BAAyE,CACzF;aAHgCD,SAAAA;aAEhBC,gCAAAA;IACf;AA0DJ;;;;;;;;;;;;;;;;;;;;;;iEA5D2BC,4DAA6B"}