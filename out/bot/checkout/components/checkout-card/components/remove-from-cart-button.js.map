{"version":3,"sources":["../../../../../../src/bot/checkout/components/checkout-card/components/remove-from-cart-button.ts"],"sourcesContent":["import { forwardRef, Inject, Injectable } from \"@nestjs/common\";\r\nimport {\r\n\tModal,\r\n\tContext,\r\n\tSlashCommand,\r\n\tSlashCommandContext,\r\n\tCtx,\r\n\tModalContext,\r\n\tStringSelect,\r\n\tStringSelectContext,\r\n\tSelectedStrings,\r\n\tButton,\r\n\tComponentParam,\r\n} from \"necord\";\r\nimport {\r\n\tActionRowBuilder,\r\n\tButtonBuilder,\r\n\tButtonInteraction,\r\n\tButtonStyle,\r\n\tCacheType,\r\n\tChatInputCommandInteraction,\r\n\tClient,\r\n\tEmbedBuilder,\r\n\tMessage,\r\n\tModalActionRowComponentBuilder,\r\n\tModalBuilder,\r\n\tModalSubmitInteraction,\r\n\tTextChannel,\r\n\tTextInputBuilder,\r\n\tTextInputStyle,\r\n} from \"discord.js\";\r\nimport { BotConfig } from \"@/config\";\r\nimport { ProductProps } from \"@/@shared/sharpify/api\";\r\nimport { formatPrice } from \"@/@shared/lib\";\r\nimport TurndownService from \"turndown\";\r\nimport { DiscordUserEntity, ProductEntity } from \"@/@shared/db/entities\";\r\nimport { ValidateDatabaseCartItemsHelper } from \"../../../helpers\";\r\nimport { formatCheckoutCartItemNameHelper, getCheckoutCartItemsHelper } from \"../helper\";\r\nimport { SectionManagerHandler } from \"../section-manager\";\r\nimport { WrapperType } from \"@/@shared/types\";\r\nimport { RemoveFromCartUsecase } from \"../usecases\";\r\n\r\n@Injectable()\r\nexport class RemoveFromCartButtonComponent {\r\n\tconstructor(\r\n\t\t@Inject(Client) private readonly client: Client,\r\n\t\t@Inject(forwardRef(() => SectionManagerHandler))\r\n\t\tprivate readonly sectionManagerHandler: WrapperType<SectionManagerHandler>,\r\n\t) {}\r\n\r\n\t@Button(\"remove_from_cart:productIdAndItemId\")\r\n\tprivate async handleButtonClicked(\r\n\t\t@Context() [interaction]: [ButtonInteraction],\r\n\t\t@ComponentParam(\"productIdAndItemId\") productIdAndItemId: string,\r\n\t) {\r\n\t\tconst [productId, productItemId] = productIdAndItemId.split(\":\");\r\n\r\n\t\tconst { cartIsEmpty } = await RemoveFromCartUsecase.execute({\r\n\t\t\tdiscordUserId: interaction.user.id,\r\n\t\t\tproductId,\r\n\t\t\tproductItemId,\r\n\t\t});\r\n\r\n\t\tawait interaction.deferUpdate();\r\n\t\tif (cartIsEmpty) return interaction.channel?.delete();\r\n\r\n\t\tconst result = await this.sectionManagerHandler.setSection({\r\n\t\t\tdiscordUserId: interaction.user.id,\r\n\t\t\tsection: \"MAIN\",\r\n\t\t});\r\n\t\tawait interaction.message.edit(result as any);\r\n\t}\r\n\r\n\tasync createButton({ productId, productItemId }: { productId: string; productItemId: string }) {\r\n\t\tconst removeFromCartButton = new ButtonBuilder()\r\n\t\t\t.setCustomId(`remove_from_cart${productId}:${productItemId}`) // unique ID to handle clicks\r\n\t\t\t.setLabel(\"Remover do carrinho\") // text on the button\r\n\t\t\t.setStyle(ButtonStyle.Danger) // gray button, like in the image\r\n\t\t\t.setEmoji(\"üóëÔ∏è\");\r\n\t\treturn { removeFromCartButton };\r\n\t}\r\n}\r\n"],"names":["RemoveFromCartButtonComponent","handleButtonClicked","interaction","productIdAndItemId","productId","productItemId","split","cartIsEmpty","RemoveFromCartUsecase","execute","discordUserId","user","id","deferUpdate","channel","delete","result","sectionManagerHandler","setSection","section","message","edit","createButton","removeFromCartButton","ButtonBuilder","setCustomId","setLabel","setStyle","ButtonStyle","Danger","setEmoji","client","SectionManagerHandler"],"mappings":";;;;+BA2CaA;;;eAAAA;;;wBA3CkC;wBAaxC;yBAiBA;gCAQ+B;uBACV;0BACU;;;;;;;;;;;;;;;AAG/B,IAAA,AAAMA,gCAAN,MAAMA;IAOZ,MACcC,oBACb,AAAW,CAACC,YAAiC,EAC7C,AAAsCC,kBAA0B,EAC/D;QACD,MAAM,CAACC,WAAWC,cAAc,GAAGF,mBAAmBG,KAAK,CAAC;QAE5D,MAAM,EAAEC,WAAW,EAAE,GAAG,MAAMC,+BAAqB,CAACC,OAAO,CAAC;YAC3DC,eAAeR,YAAYS,IAAI,CAACC,EAAE;YAClCR;YACAC;QACD;QAEA,MAAMH,YAAYW,WAAW;QAC7B,IAAIN,aAAa,OAAOL,YAAYY,OAAO,EAAEC;QAE7C,MAAMC,SAAS,MAAM,IAAI,CAACC,qBAAqB,CAACC,UAAU,CAAC;YAC1DR,eAAeR,YAAYS,IAAI,CAACC,EAAE;YAClCO,SAAS;QACV;QACA,MAAMjB,YAAYkB,OAAO,CAACC,IAAI,CAACL;IAChC;IAEA,MAAMM,aAAa,EAAElB,SAAS,EAAEC,aAAa,EAAgD,EAAE;QAC9F,MAAMkB,uBAAuB,IAAIC,sBAAa,GAC5CC,WAAW,CAAC,CAAC,gBAAgB,EAAErB,UAAU,CAAC,EAAEC,eAAe,EAAE,6BAA6B;SAC1FqB,QAAQ,CAAC,uBAAuB,qBAAqB;SACrDC,QAAQ,CAACC,oBAAW,CAACC,MAAM,EAAE,iCAAiC;SAC9DC,QAAQ,CAAC;QACX,OAAO;YAAEP;QAAqB;IAC/B;IApCA,YACC,AAAiCQ,MAAc,EAC/C,AACiBd,qBAAyD,CACzE;aAHgCc,SAAAA;aAEhBd,wBAAAA;IACf;AAiCJ;;;;;;;;;;;;;;;iEAnC2Be,qCAAqB"}