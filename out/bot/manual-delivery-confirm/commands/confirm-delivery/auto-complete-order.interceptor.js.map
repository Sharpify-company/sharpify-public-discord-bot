{"version":3,"sources":["../../../../../src/bot/manual-delivery-confirm/commands/confirm-delivery/auto-complete-order.interceptor.ts"],"sourcesContent":["import { formatPrice } from \"@/@shared/lib\";\r\nimport { Sharpify } from \"@/@shared/sharpify\";\r\nimport { Injectable } from \"@nestjs/common\";\r\nimport { AutocompleteInteraction } from \"discord.js\";\r\nimport { AutocompleteInterceptor } from \"necord\";\r\n\r\n@Injectable()\r\nexport class OrderAutocompleteInterceptor extends AutocompleteInterceptor {\r\n\tpublic async transformOptions(interaction: AutocompleteInteraction) {\r\n\t\tconst focused = interaction.options.getFocused(true);\r\n\r\n\t\tif (focused.name === \"item\") {\r\n\t\t\tconst orderId = interaction.options.getString(\"venda\");\r\n\r\n\t\t\tif (!orderId) {\r\n\t\t\t\treturn interaction.respond([]);\r\n\t\t\t}\r\n\r\n\t\t\tconst reqOrder = await Sharpify.api.v1.checkout.order.getOrder({\r\n\t\t\t\torderId,\r\n\t\t\t});\r\n\r\n\t\t\tif (!reqOrder.success) {\r\n\t\t\t\tif (reqOrder.errorName === \"OrderNotFoundError\") {\r\n\t\t\t\t\treturn interaction.respond([]);\r\n\t\t\t\t}\r\n\t\t\t\treturn interaction.respond([\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: `Error ao buscar a compra: ${reqOrder.errorName}`,\r\n\t\t\t\t\t\tvalue: \"0\",\r\n\t\t\t\t\t},\r\n\t\t\t\t]);\r\n\t\t\t}\r\n\r\n\t\t\tconst items = reqOrder.data.order.orderItems.map((item) => ({\r\n\t\t\t\tname: `${item.product.backup.viewType === \"NORMAL\" ? item.product.backup.title : `${item.product.backup.title} > ${item.product.itemBackup.title}`} (Qty: ${item.quantity})`,\r\n\t\t\t\tvalue: item.id,\r\n\t\t\t}));\r\n\r\n\t\t\treturn interaction.respond(items);\r\n\t\t}\r\n\r\n\t\tconst req = await Sharpify.api.v1.checkout.order.getOrder({\r\n\t\t\torderId: focused.value.toString(),\r\n\t\t});\r\n\r\n\t\tif (!req.success) {\r\n\t\t\tif (req.errorName === \"OrderNotFoundError\") {\r\n\t\t\t\treturn interaction.respond([]);\r\n\t\t\t}\r\n\t\t\treturn interaction.respond([\r\n\t\t\t\t{\r\n\t\t\t\t\tname: `Error ao buscar a compra: ${req.errorName}`,\r\n\t\t\t\t\tvalue: \"0\",\r\n\t\t\t\t},\r\n\t\t\t]);\r\n\t\t}\r\n\r\n\t\treturn interaction.respond([\r\n\t\t\t{\r\n\t\t\t\tname: `#${req.data.order.shortReference} | total: ${formatPrice(req.data.order.pricing.total)}`,\r\n\t\t\t\tvalue: req.data.order.id,\r\n\t\t\t},\r\n\t\t]);\r\n\t}\r\n}\r\n"],"names":["OrderAutocompleteInterceptor","AutocompleteInterceptor","transformOptions","interaction","focused","options","getFocused","name","orderId","getString","respond","reqOrder","Sharpify","api","v1","checkout","order","getOrder","success","errorName","value","items","data","orderItems","map","item","product","backup","viewType","title","itemBackup","quantity","id","req","toString","shortReference","formatPrice","pricing","total"],"mappings":";;;;+BAOaA;;;eAAAA;;;qBAPe;0BACH;wBACE;wBAEa;;;;;;;AAGjC,IAAA,AAAMA,+BAAN,MAAMA,qCAAqCC,+BAAuB;IACxE,MAAaC,iBAAiBC,WAAoC,EAAE;QACnE,MAAMC,UAAUD,YAAYE,OAAO,CAACC,UAAU,CAAC;QAE/C,IAAIF,QAAQG,IAAI,KAAK,QAAQ;YAC5B,MAAMC,UAAUL,YAAYE,OAAO,CAACI,SAAS,CAAC;YAE9C,IAAI,CAACD,SAAS;gBACb,OAAOL,YAAYO,OAAO,CAAC,EAAE;YAC9B;YAEA,MAAMC,WAAW,MAAMC,kBAAQ,CAACC,GAAG,CAACC,EAAE,CAACC,QAAQ,CAACC,KAAK,CAACC,QAAQ,CAAC;gBAC9DT;YACD;YAEA,IAAI,CAACG,SAASO,OAAO,EAAE;gBACtB,IAAIP,SAASQ,SAAS,KAAK,sBAAsB;oBAChD,OAAOhB,YAAYO,OAAO,CAAC,EAAE;gBAC9B;gBACA,OAAOP,YAAYO,OAAO,CAAC;oBAC1B;wBACCH,MAAM,CAAC,0BAA0B,EAAEI,SAASQ,SAAS,EAAE;wBACvDC,OAAO;oBACR;iBACA;YACF;YAEA,MAAMC,QAAQV,SAASW,IAAI,CAACN,KAAK,CAACO,UAAU,CAACC,GAAG,CAAC,CAACC,OAAU,CAAA;oBAC3DlB,MAAM,GAAGkB,KAAKC,OAAO,CAACC,MAAM,CAACC,QAAQ,KAAK,WAAWH,KAAKC,OAAO,CAACC,MAAM,CAACE,KAAK,GAAG,GAAGJ,KAAKC,OAAO,CAACC,MAAM,CAACE,KAAK,CAAC,GAAG,EAAEJ,KAAKC,OAAO,CAACI,UAAU,CAACD,KAAK,EAAE,CAAC,OAAO,EAAEJ,KAAKM,QAAQ,CAAC,CAAC,CAAC;oBAC5KX,OAAOK,KAAKO,EAAE;gBACf,CAAA;YAEA,OAAO7B,YAAYO,OAAO,CAACW;QAC5B;QAEA,MAAMY,MAAM,MAAMrB,kBAAQ,CAACC,GAAG,CAACC,EAAE,CAACC,QAAQ,CAACC,KAAK,CAACC,QAAQ,CAAC;YACzDT,SAASJ,QAAQgB,KAAK,CAACc,QAAQ;QAChC;QAEA,IAAI,CAACD,IAAIf,OAAO,EAAE;YACjB,IAAIe,IAAId,SAAS,KAAK,sBAAsB;gBAC3C,OAAOhB,YAAYO,OAAO,CAAC,EAAE;YAC9B;YACA,OAAOP,YAAYO,OAAO,CAAC;gBAC1B;oBACCH,MAAM,CAAC,0BAA0B,EAAE0B,IAAId,SAAS,EAAE;oBAClDC,OAAO;gBACR;aACA;QACF;QAEA,OAAOjB,YAAYO,OAAO,CAAC;YAC1B;gBACCH,MAAM,CAAC,CAAC,EAAE0B,IAAIX,IAAI,CAACN,KAAK,CAACmB,cAAc,CAAC,UAAU,EAAEC,IAAAA,gBAAW,EAACH,IAAIX,IAAI,CAACN,KAAK,CAACqB,OAAO,CAACC,KAAK,GAAG;gBAC/FlB,OAAOa,IAAIX,IAAI,CAACN,KAAK,CAACgB,EAAE;YACzB;SACA;IACF;AACD"}