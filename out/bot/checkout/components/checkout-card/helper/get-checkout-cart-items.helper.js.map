{"version":3,"sources":["../../../../../../src/bot/checkout/components/checkout-card/helper/get-checkout-cart-items.helper.ts"],"sourcesContent":["import { CheckoutCartItem } from \"../types\";\r\nimport { DiscordUserEntity, ProductEntity } from \"@/@shared/db/entities\";\r\n\r\nexport async function getCheckoutCartItemsHelper({ discordUserId }: { discordUserId: string }): Promise<CheckoutCartItem[]> {\r\n\tconst discordUserEntity = await DiscordUserEntity.findOneBy({ id: discordUserId });\r\n\tif (!discordUserEntity) return [];\r\n\r\n\tconst checkoutCartItems: CheckoutCartItem[] = [];\r\n\r\n\tconst productIds = discordUserEntity.cart.cartItems.reduce((acc, item) => {\r\n\t\tif (!acc.includes(item.productId)) {\r\n\t\t\tacc.push(item.productId);\r\n\t\t}\r\n\t\treturn acc;\r\n\t}, [] as string[]);\r\n\r\n\tconst productEntities: ProductEntity[] = [];\r\n\tfor (const productId of productIds) {\r\n\t\tconst product = await ProductEntity.findOneBy({ id: productId });\r\n\t\tproduct && productEntities.push(product);\r\n\t}\r\n\r\n\tfor (const cartItem of discordUserEntity.cart.cartItems) {\r\n\t\tconst productEntity = productEntities.find((p) => p.id === cartItem.productId);\r\n\t\tif (!productEntity) continue;\r\n\t\tconst item =\r\n\t\t\tproductEntity.productProps.settings.viewType === \"NORMAL\"\r\n\t\t\t\t? productEntity.productProps.normalItem\r\n\t\t\t\t: productEntity.productProps.dynamicItems.find((v) => v.id === cartItem.productItemId);\r\n\t\tif (!item) continue;\r\n\t\tcheckoutCartItems.push({\r\n\t\t\tproduct: productEntity.productProps,\r\n\t\t\titem,\r\n\t\t\tquantity: cartItem.quantity,\r\n\t\t});\r\n\t}\r\n\r\n\treturn checkoutCartItems;\r\n}\r\n"],"names":["getCheckoutCartItemsHelper","discordUserId","discordUserEntity","DiscordUserEntity","findOneBy","id","checkoutCartItems","productIds","cart","cartItems","reduce","acc","item","includes","productId","push","productEntities","product","ProductEntity","cartItem","productEntity","find","p","productProps","settings","viewType","normalItem","dynamicItems","v","productItemId","quantity"],"mappings":";;;;+BAGsBA;;;eAAAA;;;0BAF2B;AAE1C,eAAeA,2BAA2B,EAAEC,aAAa,EAA6B;IAC5F,MAAMC,oBAAoB,MAAMC,2BAAiB,CAACC,SAAS,CAAC;QAAEC,IAAIJ;IAAc;IAChF,IAAI,CAACC,mBAAmB,OAAO,EAAE;IAEjC,MAAMI,oBAAwC,EAAE;IAEhD,MAAMC,aAAaL,kBAAkBM,IAAI,CAACC,SAAS,CAACC,MAAM,CAAC,CAACC,KAAKC;QAChE,IAAI,CAACD,IAAIE,QAAQ,CAACD,KAAKE,SAAS,GAAG;YAClCH,IAAII,IAAI,CAACH,KAAKE,SAAS;QACxB;QACA,OAAOH;IACR,GAAG,EAAE;IAEL,MAAMK,kBAAmC,EAAE;IAC3C,KAAK,MAAMF,aAAaP,WAAY;QACnC,MAAMU,UAAU,MAAMC,uBAAa,CAACd,SAAS,CAAC;YAAEC,IAAIS;QAAU;QAC9DG,WAAWD,gBAAgBD,IAAI,CAACE;IACjC;IAEA,KAAK,MAAME,YAAYjB,kBAAkBM,IAAI,CAACC,SAAS,CAAE;QACxD,MAAMW,gBAAgBJ,gBAAgBK,IAAI,CAAC,CAACC,IAAMA,EAAEjB,EAAE,KAAKc,SAASL,SAAS;QAC7E,IAAI,CAACM,eAAe;QACpB,MAAMR,OACLQ,cAAcG,YAAY,CAACC,QAAQ,CAACC,QAAQ,KAAK,WAC9CL,cAAcG,YAAY,CAACG,UAAU,GACrCN,cAAcG,YAAY,CAACI,YAAY,CAACN,IAAI,CAAC,CAACO,IAAMA,EAAEvB,EAAE,KAAKc,SAASU,aAAa;QACvF,IAAI,CAACjB,MAAM;QACXN,kBAAkBS,IAAI,CAAC;YACtBE,SAASG,cAAcG,YAAY;YACnCX;YACAkB,UAAUX,SAASW,QAAQ;QAC5B;IACD;IAEA,OAAOxB;AACR"}