{"version":3,"sources":["../../../../../../src/bot/checkout/components/checkout-card/components/cart-emmbed.ts"],"sourcesContent":["import { Inject, Injectable } from \"@nestjs/common\";\r\nimport { Modal, Context, SlashCommand, SlashCommandContext, Ctx, ModalContext } from \"necord\";\r\nimport {\r\n\tActionRowBuilder,\r\n\tCacheType,\r\n\tChatInputCommandInteraction,\r\n\tClient,\r\n\tEmbedBuilder,\r\n\tMessage,\r\n\tModalActionRowComponentBuilder,\r\n\tModalBuilder,\r\n\tModalSubmitInteraction,\r\n\tTextChannel,\r\n\tTextInputBuilder,\r\n\tTextInputStyle,\r\n} from \"discord.js\";\r\nimport { BotConfig } from \"@/config\";\r\nimport { ProductProps } from \"@/@shared/sharpify/api\";\r\nimport { formatPrice } from \"@/@shared/lib\";\r\nimport TurndownService from \"turndown\";\r\nimport { DiscordUserEntity, EmojiEntity, ProductEntity } from \"@/@shared/db/entities\";\r\nimport { ValidateDatabaseCartItemsHelper } from \"../../../helpers\";\r\nimport { formatCheckoutCartItemNameHelper, getCheckoutCartItemsHelper } from \"../helper\";\r\nimport { getLocalStoreConfig } from \"@/@shared/sharpify\";\r\nimport { FindEmojiHelper } from \"@/@shared/helpers\";\r\n\r\n@Injectable()\r\nexport class CartEmmbedComponent {\r\n\tconstructor(@Inject(Client) private readonly client: Client) {}\r\n\r\n\tasync makeCartEmmbed({ discordUserId }: { discordUserId: string }) {\r\n\t\tawait ValidateDatabaseCartItemsHelper({ discordUserId });\r\n\t\tconst { name } = await getLocalStoreConfig();\r\n\r\n\t\tconst discordUserEntity = await DiscordUserEntity.findOneBy({ id: discordUserId });\r\n\t\tif (!discordUserEntity) return { emmbed: new EmbedBuilder().setColor(BotConfig.color).setTitle(\"Compra\") };\r\n\r\n\t\tconst discordMember = await this.client.users.fetch(discordUserId);\r\n\t\tif (!discordMember) return { emmbed: new EmbedBuilder().setColor(BotConfig.color).setTitle(\"Compra\") };\r\n\r\n\t\tconst checkoutCartItems = await getCheckoutCartItemsHelper({ discordUserId });\r\n\r\n\t\tconst productList = checkoutCartItems\r\n\t\t\t.map(\r\n\t\t\t\t(item) =>\r\n\t\t\t\t\t`‚Ä¢ \\`\\`${item.quantity}x ${formatCheckoutCartItemNameHelper(item)} ‚Äì ${formatPrice(item.item.pricing.price)}\\`\\``,\r\n\t\t\t)\r\n\t\t\t.join(\"\\n\");\r\n\r\n\t\tconst ticketEmoji = await FindEmojiHelper({ client: this.client, name: \"Sharpify_ticket\" });\r\n\t\tconst meneyEmoji = await FindEmojiHelper({ client: this.client, name: \"Sharpify_money\" });\r\n\t\tconst cartEmoji = await FindEmojiHelper({ client: this.client, name: \"Sharpify_carrinho\" });\r\n\r\n\t\tconst emmbed = new EmbedBuilder()\r\n\t\t\t.setColor(BotConfig.color)\r\n\t\t\t.setTitle(`üõí Carrinho de compras de ${discordMember.displayName}`)\r\n\t\t\t.setDescription(`Ol√° ${discordMember}, aqui est√° o resumo do seu carrinho de compras:`)\r\n\t\t\t.addFields(\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"üì¶ **Produtos no carrinho**\",\r\n\t\t\t\t\tvalue: productList.length ? productList : \"Seu carrinho est√° vazio.\",\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: `${meneyEmoji} **Subtotal**`,\r\n\t\t\t\t\tvalue: \"``\" + formatPrice(discordUserEntity.cart.subTotalPrice) + \"``\",\r\n\t\t\t\t\tinline: true,\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: `${ticketEmoji} **Cupom de desconto**`,\r\n\t\t\t\t\tvalue:\r\n\t\t\t\t\t\t\"``\" +\r\n\t\t\t\t\t\t(discordUserEntity.cart.couponCode\r\n\t\t\t\t\t\t\t? discordUserEntity.cart.couponCode.toUpperCase()\r\n\t\t\t\t\t\t\t: \"Sem cupom aplicado\") +\r\n\t\t\t\t\t\t\"``\",\r\n\t\t\t\t\tinline: true,\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: `${cartEmoji} **Valor total**`,\r\n\t\t\t\t\tvalue: \"``\" + formatPrice(discordUserEntity.cart.totalPrice) + \"``\",\r\n\t\t\t\t\tinline: true,\r\n\t\t\t\t},\r\n\t\t\t)\r\n\t\t\t.setFooter({\r\n\t\t\t\ttext: `üíº Sistema de Compra - ¬©${name} Todos os direitos reservados`,\r\n\t\t\t});\r\n\t\treturn { emmbed };\r\n\t}\r\n\r\n\tasync makeSingleCartItemEmmbed({\r\n\t\tdiscordUserId,\r\n\t\titemId,\r\n\t\tproductId,\r\n\t}: {\r\n\t\tdiscordUserId: string;\r\n\t\tproductId: string;\r\n\t\titemId: string;\r\n\t}) {\r\n\t\tconst checkoutCartItems = await getCheckoutCartItemsHelper({ discordUserId });\r\n\t\tconst { name } = await getLocalStoreConfig();\r\n\r\n\t\tconst cartItem = checkoutCartItems.find((item) => item.item.id === itemId && item.product.id === productId);\r\n\t\tif (!cartItem) return { emmbed: new EmbedBuilder().setColor(BotConfig.color).setTitle(\"Compra\") };\r\n\r\n\t\tconst emmbed = new EmbedBuilder()\r\n\t\t\t.setColor(BotConfig.color)\r\n\t\t\t.setTitle(`üõí Gerenciamento do item`)\r\n\t\t\t.addFields(\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"üì¶ **Nome do produto**\",\r\n\t\t\t\t\tvalue: `‚Ä¢ \\`\\`${formatCheckoutCartItemNameHelper(cartItem)}\\`\\``,\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"üßæ **Subtotal**\",\r\n\t\t\t\t\tvalue: `\\`\\`${formatPrice(cartItem.item.pricing.price)}\\`\\``,\r\n\t\t\t\t\tinline: true,\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"üè∑Ô∏è **Quantidade selecionada**\",\r\n\t\t\t\t\tvalue: `\\`\\`${cartItem.quantity} de ${cartItem.item.inventory.stockQuantity === null ? \"Ilimitado\" : `${cartItem.item.inventory.stockQuantity} unidades`}\\`\\``,\r\n\t\t\t\t\tinline: true,\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"üí∞ **Valor total**\",\r\n\t\t\t\t\tvalue: `\\`\\`${formatPrice(cartItem.item.pricing.price * cartItem.quantity)}\\`\\``,\r\n\t\t\t\t\tinline: true,\r\n\t\t\t\t},\r\n\t\t\t)\r\n\t\t\t.setFooter({\r\n\t\t\t\ttext: `üíº Sistema de Compra - ¬©${name} Todos os direitos reservados`,\r\n\t\t\t});\r\n\t\treturn { emmbed };\r\n\t}\r\n}\r\n"],"names":["CartEmmbedComponent","makeCartEmmbed","discordUserId","ValidateDatabaseCartItemsHelper","name","getLocalStoreConfig","discordUserEntity","DiscordUserEntity","findOneBy","id","emmbed","EmbedBuilder","setColor","BotConfig","color","setTitle","discordMember","client","users","fetch","checkoutCartItems","getCheckoutCartItemsHelper","productList","map","item","quantity","formatCheckoutCartItemNameHelper","formatPrice","pricing","price","join","ticketEmoji","FindEmojiHelper","meneyEmoji","cartEmoji","displayName","setDescription","addFields","value","length","cart","subTotalPrice","inline","couponCode","toUpperCase","totalPrice","setFooter","text","makeSingleCartItemEmmbed","itemId","productId","cartItem","find","product","inventory","stockQuantity"],"mappings":"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"}