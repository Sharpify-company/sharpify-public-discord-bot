{"version":3,"sources":["../../../../../../../src/bot/checkout/components/product-card/usecases/add-to-cart/ensure-user-exists-on-db.ts"],"sourcesContent":["import { dotEnv, Either, failure, success } from \"@/@shared/lib\";\r\nimport { AddToCartUsecase } from \"./_add-to-cart.usecase\";\r\nimport { ProductProps } from \"@/@shared/sharpify/api\";\r\nimport { Sharpify } from \"@/@shared/sharpify\";\r\nimport { ChannelType, InteractionResponse, PermissionsBitField } from \"discord.js\";\r\nimport { DiscordUserEntity } from \"@/@shared/db/entities\";\r\n\r\nexport async function EnsureUserExistsOnDb({\r\n\tinteraction,\r\n}: Parameters<typeof AddToCartUsecase.prototype.execute>[0]): Promise<Either<InteractionResponse, DiscordUserEntity>> {\r\n\tconst member = interaction.member;\r\n\tif (!member?.user) {\r\n\t\treturn failure(\r\n\t\t\tawait interaction.reply({\r\n\t\t\t\tcontent: `Erro ao identificar usu√°rio.`,\r\n\t\t\t\tflags: [\"Ephemeral\"],\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\tlet discordUserEntity = await DiscordUserEntity.findOneBy({ id: member.user.id });\r\n\tif (!discordUserEntity) {\r\n\t\tdiscordUserEntity = DiscordUserEntity.create({\r\n\t\t\tid: member.user.id,\r\n\t\t});\r\n\r\n\t\tawait discordUserEntity.save();\r\n\t}\r\n\r\n\treturn success(discordUserEntity);\r\n}\r\n"],"names":["EnsureUserExistsOnDb","interaction","member","user","failure","reply","content","flags","discordUserEntity","DiscordUserEntity","findOneBy","id","create","save","success"],"mappings":";;;;+BAOsBA;;;eAAAA;;;qBAP2B;0BAKf;AAE3B,eAAeA,qBAAqB,EAC1CC,WAAW,EAC+C;IAC1D,MAAMC,SAASD,YAAYC,MAAM;IACjC,IAAI,CAACA,QAAQC,MAAM;QAClB,OAAOC,IAAAA,YAAO,EACb,MAAMH,YAAYI,KAAK,CAAC;YACvBC,SAAS,CAAC,4BAA4B,CAAC;YACvCC,OAAO;gBAAC;aAAY;QACrB;IAEF;IAEA,IAAIC,oBAAoB,MAAMC,2BAAiB,CAACC,SAAS,CAAC;QAAEC,IAAIT,OAAOC,IAAI,CAACQ,EAAE;IAAC;IAC/E,IAAI,CAACH,mBAAmB;QACvBA,oBAAoBC,2BAAiB,CAACG,MAAM,CAAC;YAC5CD,IAAIT,OAAOC,IAAI,CAACQ,EAAE;QACnB;QAEA,MAAMH,kBAAkBK,IAAI;IAC7B;IAEA,OAAOC,IAAAA,YAAO,EAACN;AAChB"}