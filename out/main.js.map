{"version":3,"sources":["../src/main.ts"],"sourcesContent":["import { NestFactory } from \"@nestjs/core\";\r\nimport { AppModule } from \"@/app.module\";\r\nimport { TypeormProvider } from \"./@shared/db/typeorm\";\r\nimport { Sharpify } from \"./@shared/sharpify\";\r\nimport { StoreConfigEntity } from \"./@shared/db/entities\";\r\nError.stackTraceLimit = 50; // default is 10\r\n\r\n// --- ANTI-CRASH ---\r\nfunction formatStack(stack?: string) {\r\n    if (!stack) return '   (sem stack trace)';\r\n    const lines = stack.split('\\n');\r\n    const frames = lines.filter(l => l.trim().startsWith('at '));\r\n    const srcFrames = frames.filter(l => l.includes('src\\\\') || l.includes('src/'))\r\n        .filter(l => !l.includes('node_modules'));\r\n    if (srcFrames.length > 0) {\r\n        return `   üìç Seu c√≥digo:\\n${srcFrames.map(l => `   ${l.trim()}`).join('\\n')}`;\r\n    }\r\n    const topFrames = frames.slice(0, 5);\r\n    if (topFrames.length > 0) {\r\n        return `   ‚ö†Ô∏è Nenhuma linha do seu c√≥digo no stack (erro interno de lib).\\n   Stack:\\n${topFrames.map(l => `   ${l.trim()}`).join('\\n')}`;\r\n    }\r\n    return '   (sem stack trace √∫til)';\r\n}\r\n\r\nprocess.on('unhandledRejection', (reason, promise) => {\r\n    console.error('üö® [Anti-Crash] Rejei√ß√£o de Promise n√£o tratada:');\r\n    if (reason instanceof Error) {\r\n        console.error(`   Nome: ${reason.name}`);\r\n        console.error(`   Mensagem: ${reason.message}`);\r\n        console.error(formatStack(reason.stack));\r\n    } else {\r\n        console.error('   Raz√£o:', reason);\r\n    }\r\n});\r\n\r\nprocess.on('uncaughtException', (error) => {\r\n    console.error('üö® [Anti-Crash] Erro n√£o capturado:');\r\n    console.error(`   Nome: ${error?.name}`);\r\n    console.error(`   Mensagem: ${error?.message}`);\r\n    console.error(formatStack(error?.stack));\r\n});\r\n// ------------------\r\n\r\nasync function bootstrap() {\r\n\tawait TypeormProvider.init();\r\n\r\n\tconst getStoreReq = await Sharpify.api.v1.management.store.getStore();\r\n\tif (!getStoreReq.success) {\r\n\t\tthrow new Error(\r\n\t\t\t`\r\n\t\t\tBuscar configuracao da loja falhou quando inicializando a aplicac√£o\r\n\t\t\tVerifique se a API_KEY e STORE_ID est√£o corretos, para mais detalhes veja o log abaixo.:\r\n\t\t\t` + getStoreReq.errorName,\r\n\t\t);\r\n\t}\r\n\r\n\tlet storeConfigEntity = await StoreConfigEntity.findOneBy({ id: \"DEFAULT\" });\r\n\tif (!storeConfigEntity) await StoreConfigEntity.createStore(getStoreReq.data).save();\r\n\telse await storeConfigEntity.updateProps(getStoreReq.data);\r\n\r\n\tconst app = await NestFactory.create(AppModule);\r\n\r\n\tawait app.init();\r\n}\r\nbootstrap();\r\n"],"names":["Error","stackTraceLimit","formatStack","stack","lines","split","frames","filter","l","trim","startsWith","srcFrames","includes","length","map","join","topFrames","slice","process","on","reason","promise","console","error","name","message","bootstrap","TypeormProvider","init","getStoreReq","Sharpify","api","v1","management","store","getStore","success","errorName","storeConfigEntity","StoreConfigEntity","findOneBy","id","createStore","data","save","updateProps","app","NestFactory","create","AppModule"],"mappings":";;;;sBAA4B;2BACF;yBACM;0BACP;0BACS;AAClCA,MAAMC,eAAe,GAAG,IAAI,gBAAgB;AAE5C,qBAAqB;AACrB,SAASC,YAAYC,KAAc;IAC/B,IAAI,CAACA,OAAO,OAAO;IACnB,MAAMC,QAAQD,MAAME,KAAK,CAAC;IAC1B,MAAMC,SAASF,MAAMG,MAAM,CAACC,CAAAA,IAAKA,EAAEC,IAAI,GAAGC,UAAU,CAAC;IACrD,MAAMC,YAAYL,OAAOC,MAAM,CAACC,CAAAA,IAAKA,EAAEI,QAAQ,CAAC,YAAYJ,EAAEI,QAAQ,CAAC,SAClEL,MAAM,CAACC,CAAAA,IAAK,CAACA,EAAEI,QAAQ,CAAC;IAC7B,IAAID,UAAUE,MAAM,GAAG,GAAG;QACtB,OAAO,CAAC,mBAAmB,EAAEF,UAAUG,GAAG,CAACN,CAAAA,IAAK,CAAC,GAAG,EAAEA,EAAEC,IAAI,IAAI,EAAEM,IAAI,CAAC,OAAO;IAClF;IACA,MAAMC,YAAYV,OAAOW,KAAK,CAAC,GAAG;IAClC,IAAID,UAAUH,MAAM,GAAG,GAAG;QACtB,OAAO,CAAC,8EAA8E,EAAEG,UAAUF,GAAG,CAACN,CAAAA,IAAK,CAAC,GAAG,EAAEA,EAAEC,IAAI,IAAI,EAAEM,IAAI,CAAC,OAAO;IAC7I;IACA,OAAO;AACX;AAEAG,QAAQC,EAAE,CAAC,sBAAsB,CAACC,QAAQC;IACtCC,QAAQC,KAAK,CAAC;IACd,IAAIH,kBAAkBpB,OAAO;QACzBsB,QAAQC,KAAK,CAAC,CAAC,SAAS,EAAEH,OAAOI,IAAI,EAAE;QACvCF,QAAQC,KAAK,CAAC,CAAC,aAAa,EAAEH,OAAOK,OAAO,EAAE;QAC9CH,QAAQC,KAAK,CAACrB,YAAYkB,OAAOjB,KAAK;IAC1C,OAAO;QACHmB,QAAQC,KAAK,CAAC,aAAaH;IAC/B;AACJ;AAEAF,QAAQC,EAAE,CAAC,qBAAqB,CAACI;IAC7BD,QAAQC,KAAK,CAAC;IACdD,QAAQC,KAAK,CAAC,CAAC,SAAS,EAAEA,OAAOC,MAAM;IACvCF,QAAQC,KAAK,CAAC,CAAC,aAAa,EAAEA,OAAOE,SAAS;IAC9CH,QAAQC,KAAK,CAACrB,YAAYqB,OAAOpB;AACrC;AACA,qBAAqB;AAErB,eAAeuB;IACd,MAAMC,wBAAe,CAACC,IAAI;IAE1B,MAAMC,cAAc,MAAMC,kBAAQ,CAACC,GAAG,CAACC,EAAE,CAACC,UAAU,CAACC,KAAK,CAACC,QAAQ;IACnE,IAAI,CAACN,YAAYO,OAAO,EAAE;QACzB,MAAM,IAAIpC,MACT,CAAC;;;GAGD,CAAC,GAAG6B,YAAYQ,SAAS;IAE3B;IAEA,IAAIC,oBAAoB,MAAMC,2BAAiB,CAACC,SAAS,CAAC;QAAEC,IAAI;IAAU;IAC1E,IAAI,CAACH,mBAAmB,MAAMC,2BAAiB,CAACG,WAAW,CAACb,YAAYc,IAAI,EAAEC,IAAI;SAC7E,MAAMN,kBAAkBO,WAAW,CAAChB,YAAYc,IAAI;IAEzD,MAAMG,MAAM,MAAMC,iBAAW,CAACC,MAAM,CAACC,oBAAS;IAE9C,MAAMH,IAAIlB,IAAI;AACf;AACAF"}