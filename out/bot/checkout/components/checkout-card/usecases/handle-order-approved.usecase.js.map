{"version":3,"sources":["../../../../../../src/bot/checkout/components/checkout-card/usecases/handle-order-approved.usecase.ts"],"sourcesContent":["import { Sharpify } from \"@/@shared/sharpify\";\r\nimport {\r\n\tActionRowBuilder,\r\n\tButtonBuilder,\r\n\tButtonInteraction,\r\n\tButtonStyle,\r\n\tCacheType,\r\n\tChannelType,\r\n\tClient,\r\n\tEmbedBuilder,\r\n\tPermissionsBitField,\r\n} from \"discord.js\";\r\nimport { dotEnv } from \"@/@shared/lib\";\r\n\r\nimport { ValidateDatabaseCartItemsHelper } from \"@/bot/checkout/helpers\";\r\nimport { Inject, Injectable } from \"@nestjs/common\";\r\nimport { DiscordUserEntity, OrderEntity } from \"@/@shared/db/entities\";\r\n\r\n@Injectable()\r\nexport class HandleOrderApprovedUsecase {\r\n\tconstructor(@Inject(Client) private readonly client: Client) {}\r\n\r\n\tasync execute({ orderId }: { orderId: string }) {\r\n\t\tconst orderEntity = await OrderEntity.findOneBy({ id: orderId });\r\n\t\tif (!orderEntity) return;\r\n\r\n\t\tconst discordUser = await DiscordUserEntity.findOneBy({ id: orderEntity.customerId });\r\n\t\tif (!discordUser) return;\r\n\r\n\t\tconst orderChannel = await this.client.channels.fetch(discordUser.cart.channelId!).catch(() => null);\r\n\t\torderChannel && (await orderChannel.delete().catch(() => null));\r\n\r\n\t\tawait orderEntity.markAsPreparingDelivery();\r\n\t\tawait discordUser.cart.cancelOrder();\r\n\t}\r\n}\r\n"],"names":["HandleOrderApprovedUsecase","execute","orderId","orderEntity","OrderEntity","findOneBy","id","discordUser","DiscordUserEntity","customerId","orderChannel","client","channels","fetch","cart","channelId","catch","delete","markAsPreparingDelivery","cancelOrder"],"mappings":";;;;+BAmBaA;;;eAAAA;;;yBARN;wBAI4B;0BACY;;;;;;;;;;;;;;;AAGxC,IAAA,AAAMA,6BAAN,MAAMA;IAGZ,MAAMC,QAAQ,EAAEC,OAAO,EAAuB,EAAE;QAC/C,MAAMC,cAAc,MAAMC,qBAAW,CAACC,SAAS,CAAC;YAAEC,IAAIJ;QAAQ;QAC9D,IAAI,CAACC,aAAa;QAElB,MAAMI,cAAc,MAAMC,2BAAiB,CAACH,SAAS,CAAC;YAAEC,IAAIH,YAAYM,UAAU;QAAC;QACnF,IAAI,CAACF,aAAa;QAElB,MAAMG,eAAe,MAAM,IAAI,CAACC,MAAM,CAACC,QAAQ,CAACC,KAAK,CAACN,YAAYO,IAAI,CAACC,SAAS,EAAGC,KAAK,CAAC,IAAM;QAC/FN,gBAAiB,MAAMA,aAAaO,MAAM,GAAGD,KAAK,CAAC,IAAM;QAEzD,MAAMb,YAAYe,uBAAuB;QACzC,MAAMX,YAAYO,IAAI,CAACK,WAAW;IACnC;IAdA,YAAY,AAAiCR,MAAc,CAAE;aAAhBA,SAAAA;IAAiB;AAe/D"}