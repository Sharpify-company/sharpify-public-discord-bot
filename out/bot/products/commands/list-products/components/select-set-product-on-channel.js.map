{"version":3,"sources":["../../../../../../src/bot/products/commands/list-products/components/select-set-product-on-channel.ts"],"sourcesContent":["import { Injectable } from \"@nestjs/common\";\r\nimport {\r\n\tModal,\r\n\tContext,\r\n\tSlashCommand,\r\n\tSlashCommandContext,\r\n\tCtx,\r\n\tStringSelect,\r\n\tStringSelectContext,\r\n\tSelectedStrings,\r\n\tSelectedChannels,\r\n\tChannelSelect,\r\n\tISelectedChannels,\r\n\tComponentParam,\r\n} from \"necord\";\r\nimport {\r\n\tActionRowBuilder,\r\n\tCacheType,\r\n\tChannelSelectMenuBuilder,\r\n\tChannelType,\r\n\tChatInputCommandInteraction,\r\n\tEmbedBuilder,\r\n\tModalActionRowComponentBuilder,\r\n\tModalBuilder,\r\n\tModalSubmitInteraction,\r\n\tStringSelectMenuBuilder,\r\n\tStringSelectMenuInteraction,\r\n\tTextInputBuilder,\r\n\tTextInputStyle,\r\n} from \"discord.js\";\r\nimport { BotConfig } from \"@/config\";\r\nimport { ProductProps } from \"@/@shared/sharpify/api\";\r\nimport { formatPrice } from \"@/@shared/lib\";\r\nimport TurndownService from \"turndown\";\r\nimport { ProductCardComponent } from \"@/bot/checkout/components\";\r\nimport { Sharpify } from \"@/@shared/sharpify\";\r\nimport { OrderEntity, ProductEntity } from \"@/@shared/db/entities\";\r\nimport { MemoryCreateConfig } from \"../memory-create-config\";\r\n\r\n@Injectable()\r\nexport class SelectSetProductOnChannel {\r\n\tconstructor(private readonly productCardComponent: ProductCardComponent) {}\r\n\r\n\t@ChannelSelect(\"select_set_product_on_channel:productId\")\r\n\tprivate async handleChannelSelected(\r\n\t\t@Context() [interaction]: StringSelectContext,\r\n\t\t@SelectedChannels() selected: ISelectedChannels,\r\n\t\t@ComponentParam(\"productId\") productId: string,\r\n\t) {\r\n\t\tconst channel = interaction.guild?.channels.cache.get(selected?.at(0)!.id);\r\n\r\n\t\tif (!channel?.isTextBased()) {\r\n\t\t\treturn interaction.reply({\r\n\t\t\t\tcontent: \"O canal selecionado não é um canal de texto válido.\",\r\n\t\t\t\tflags: [\"Ephemeral\"],\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst product = await Sharpify.api.v1.catalog.product.get({\r\n\t\t\tid: productId,\r\n\t\t\tincludeNonListed: true\r\n\t\t});\r\n\r\n\t\tif (!product.success) {\r\n\t\t\treturn interaction.reply({\r\n\t\t\t\tcontent: `Error ao buscar produto: ${product.errorName}`,\r\n\t\t\t\tflags: [\"Ephemeral\"],\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tlet productEntity = await ProductEntity.findOneBy({ id: product.data.product.id });\r\n\t\tif (!productEntity) {\r\n\t\t\tproductEntity = ProductEntity.createProduct({\r\n\t\t\t\tid: product.data.product.id,\r\n\t\t\t\tproductProps: product.data.product,\r\n\t\t\t});\r\n\t\t\tawait productEntity.save();\r\n\t\t}\r\n\r\n\t\tconst reply = await this.productCardComponent.sendProductCardToChannel({\r\n\t\t\tchannel: channel as any,\r\n\t\t\tproduct: product.data.product,\r\n\t\t});\r\n\r\n\t\tawait productEntity.setChannelLinked({ channelId: channel.id, messageId: reply.id });\r\n\r\n\t\tinteraction.reply({\r\n\t\t\tcontent: \"Produto setado no canal com sucesso!\",\r\n\t\t\tflags: [\"Ephemeral\"],\r\n\t\t});\r\n\t}\r\n\r\n\tcreateSelectChannel({\r\n\t\tinteraction,\r\n\t\tproduct,\r\n\t}: {\r\n\t\tinteraction: ChatInputCommandInteraction<CacheType>;\r\n\t\tproduct: ProductProps;\r\n\t}) {\r\n\t\tconst selectMenu = new ChannelSelectMenuBuilder()\r\n\t\t\t.setCustomId(`select_set_product_on_channel${product.id}`)\r\n\t\t\t.setPlaceholder(\"Selecione qual canal colocar o produto...\")\r\n\t\t\t.setMaxValues(1)\r\n\t\t\t.setMinValues(1);\r\n\t\treturn new ActionRowBuilder<ChannelSelectMenuBuilder>().addComponents(selectMenu);\r\n\t}\r\n}\r\n"],"names":["SelectSetProductOnChannel","handleChannelSelected","interaction","selected","productId","channel","guild","channels","cache","get","at","id","isTextBased","reply","content","flags","product","Sharpify","api","v1","catalog","includeNonListed","success","errorName","productEntity","ProductEntity","findOneBy","data","createProduct","productProps","save","productCardComponent","sendProductCardToChannel","setChannelLinked","channelId","messageId","createSelectChannel","selectMenu","ChannelSelectMenuBuilder","setCustomId","setPlaceholder","setMaxValues","setMinValues","ActionRowBuilder","addComponents"],"mappings":";;;;+BAwCaA;;;eAAAA;;;wBAxCc;wBAcpB;yBAeA;4BAK8B;0BACZ;0BACkB;;;;;;;;;;;;;;;AAIpC,IAAA,AAAMA,4BAAN,MAAMA;IAGZ,MACcC,sBACb,AAAW,CAACC,YAAiC,EAC7C,AAAoBC,QAA2B,EAC/C,AAA6BC,SAAiB,EAC7C;QACD,MAAMC,UAAUH,YAAYI,KAAK,EAAEC,SAASC,MAAMC,IAAIN,UAAUO,GAAG,GAAIC;QAEvE,IAAI,CAACN,SAASO,eAAe;YAC5B,OAAOV,YAAYW,KAAK,CAAC;gBACxBC,SAAS;gBACTC,OAAO;oBAAC;iBAAY;YACrB;QACD;QAEA,MAAMC,UAAU,MAAMC,kBAAQ,CAACC,GAAG,CAACC,EAAE,CAACC,OAAO,CAACJ,OAAO,CAACP,GAAG,CAAC;YACzDE,IAAIP;YACJiB,kBAAkB;QACnB;QAEA,IAAI,CAACL,QAAQM,OAAO,EAAE;YACrB,OAAOpB,YAAYW,KAAK,CAAC;gBACxBC,SAAS,CAAC,yBAAyB,EAAEE,QAAQO,SAAS,EAAE;gBACxDR,OAAO;oBAAC;iBAAY;YACrB;QACD;QAEA,IAAIS,gBAAgB,MAAMC,uBAAa,CAACC,SAAS,CAAC;YAAEf,IAAIK,QAAQW,IAAI,CAACX,OAAO,CAACL,EAAE;QAAC;QAChF,IAAI,CAACa,eAAe;YACnBA,gBAAgBC,uBAAa,CAACG,aAAa,CAAC;gBAC3CjB,IAAIK,QAAQW,IAAI,CAACX,OAAO,CAACL,EAAE;gBAC3BkB,cAAcb,QAAQW,IAAI,CAACX,OAAO;YACnC;YACA,MAAMQ,cAAcM,IAAI;QACzB;QAEA,MAAMjB,QAAQ,MAAM,IAAI,CAACkB,oBAAoB,CAACC,wBAAwB,CAAC;YACtE3B,SAASA;YACTW,SAASA,QAAQW,IAAI,CAACX,OAAO;QAC9B;QAEA,MAAMQ,cAAcS,gBAAgB,CAAC;YAAEC,WAAW7B,QAAQM,EAAE;YAAEwB,WAAWtB,MAAMF,EAAE;QAAC;QAElFT,YAAYW,KAAK,CAAC;YACjBC,SAAS;YACTC,OAAO;gBAAC;aAAY;QACrB;IACD;IAEAqB,oBAAoB,EACnBlC,WAAW,EACXc,OAAO,EAIP,EAAE;QACF,MAAMqB,aAAa,IAAIC,iCAAwB,GAC7CC,WAAW,CAAC,CAAC,6BAA6B,EAAEvB,QAAQL,EAAE,EAAE,EACxD6B,cAAc,CAAC,6CACfC,YAAY,CAAC,GACbC,YAAY,CAAC;QACf,OAAO,IAAIC,yBAAgB,GAA6BC,aAAa,CAACP;IACvE;IAhEA,YAAY,AAAiBN,oBAA0C,CAAE;aAA5CA,uBAAAA;IAA6C;AAiE3E"}