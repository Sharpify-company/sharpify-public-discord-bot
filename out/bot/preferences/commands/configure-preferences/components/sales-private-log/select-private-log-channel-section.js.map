{"version":3,"sources":["../../../../../../../src/bot/preferences/commands/configure-preferences/components/sales-private-log/select-private-log-channel-section.ts"],"sourcesContent":["import { forwardRef, Inject, Injectable } from \"@nestjs/common\";\r\nimport {\r\n\tModal,\r\n\tContext,\r\n\tSlashCommand,\r\n\tSlashCommandContext,\r\n\tCtx,\r\n\tStringSelect,\r\n\tStringSelectContext,\r\n\tSelectedStrings,\r\n\tSelectedChannels,\r\n\tChannelSelect,\r\n\tISelectedChannels,\r\n\tComponentParam,\r\n} from \"necord\";\r\nimport {\r\n\tActionRowBuilder,\r\n\tCacheType,\r\n\tChannelSelectMenuBuilder,\r\n\tChannelType,\r\n\tChatInputCommandInteraction,\r\n\tClient,\r\n\tEmbedBuilder,\r\n\tModalActionRowComponentBuilder,\r\n\tModalBuilder,\r\n\tModalSubmitInteraction,\r\n\tStringSelectMenuBuilder,\r\n\tStringSelectMenuInteraction,\r\n\tTextChannel,\r\n\tTextInputBuilder,\r\n\tTextInputStyle,\r\n} from \"discord.js\";\r\nimport { BotConfig } from \"@/config\";\r\nimport { ProductProps } from \"@/@shared/sharpify/api\";\r\nimport { formatPrice } from \"@/@shared/lib\";\r\nimport TurndownService from \"turndown\";\r\nimport { ProductCardComponent } from \"@/bot/checkout/components\";\r\nimport { getLocalStoreConfig, Sharpify } from \"@/@shared/sharpify\";\r\nimport { OrderEntity, ProductEntity } from \"@/@shared/db/entities\";\r\nimport { BuildPreferenceConfigure } from \"../_build-preference-configure\";\r\nimport { WrapperType } from \"@/@shared/types\";\r\n\r\n@Injectable()\r\nexport class SelectSalesPrivateLogChannel {\r\n\tconstructor(\r\n\t\t@Inject(forwardRef(() => BuildPreferenceConfigure))\r\n\t\tprivate readonly buildPreferenceConfigure: WrapperType<BuildPreferenceConfigure>,\r\n\t\t@Inject(Client) private readonly client: Client,\r\n\t) {}\r\n\r\n\t@ChannelSelect(\"select_sales_private_log_channel\")\r\n\tprivate async handleChannelSelected(\r\n\t\t@Context() [interaction]: StringSelectContext,\r\n\t\t@SelectedChannels() selected: ISelectedChannels,\r\n\t) {\r\n\t\tconst channel = interaction.guild?.channels.cache.get(selected?.at(0)!.id);\r\n\r\n\t\tif (!channel?.isTextBased()) {\r\n\t\t\treturn interaction.reply({\r\n\t\t\t\tcontent: \"O canal selecionado não é um canal de texto válido.\",\r\n\t\t\t\tflags: [\"Ephemeral\"],\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst store = await getLocalStoreConfig();\r\n\t\tconst preferences = store.getPreferences();\r\n\t\tpreferences.privateLogSales.channelId = channel.id;\r\n\t\tawait store.savePreferences(preferences);\r\n\r\n\t\tawait interaction.update((await this.buildPreferenceConfigure.build({ section: \"SALES_PRIVATE_LOG\" })) as any);\r\n\t}\r\n\r\n\tasync createSelectChannel() {\r\n\t\tconst store = await getLocalStoreConfig();\r\n\t\tconst preferences = store.getPreferences();\r\n\r\n\t\tconst selectMenu = new ChannelSelectMenuBuilder()\r\n\t\t\t.setCustomId(`select_sales_private_log_channel`)\r\n\t\t\t.setPlaceholder(\"Selecione qual canal o log privado vai ser mandado...\")\r\n\t\t\t.setMaxValues(1)\r\n\t\t\t.setMinValues(1);\r\n\r\n\t\tconst defaultPlaceholder = \"Selecione qual canal o log privado vai ser mandado...\";\r\n\t\tif (preferences.privateLogSales.channelId) {\r\n\t\t\tconst channel = (await this.client.channels\r\n\t\t\t\t.fetch(preferences.privateLogSales.channelId)\r\n\t\t\t\t.catch(() => null)) as TextChannel;\r\n\t\t\tif (channel) {\r\n\t\t\t\tselectMenu.setPlaceholder(`✅ Canal selecionado: #${channel.name}`);\r\n\t\t\t} else selectMenu.setPlaceholder(defaultPlaceholder);\r\n\t\t} else {\r\n\t\t\tselectMenu.setPlaceholder(defaultPlaceholder);\r\n\t\t}\r\n\r\n\t\treturn new ActionRowBuilder<ChannelSelectMenuBuilder>().addComponents(selectMenu);\r\n\t}\r\n}\r\n"],"names":["SelectSalesPrivateLogChannel","handleChannelSelected","interaction","selected","channel","guild","channels","cache","get","at","id","isTextBased","reply","content","flags","store","getLocalStoreConfig","preferences","getPreferences","privateLogSales","channelId","savePreferences","update","buildPreferenceConfigure","build","section","createSelectChannel","selectMenu","ChannelSelectMenuBuilder","setCustomId","setPlaceholder","setMaxValues","setMinValues","defaultPlaceholder","client","fetch","catch","name","ActionRowBuilder","addComponents","BuildPreferenceConfigure"],"mappings":";;;;+BA2CaA;;;eAAAA;;;wBA3CkC;wBAcxC;yBAiBA;0BAMuC;0CAEL;uBACb;;;;;;;;;;;;;;;AAGrB,IAAA,AAAMA,+BAAN,MAAMA;IAOZ,MACcC,sBACb,AAAW,CAACC,YAAiC,EAC7C,AAAoBC,QAA2B,EAC9C;QACD,MAAMC,UAAUF,YAAYG,KAAK,EAAEC,SAASC,MAAMC,IAAIL,UAAUM,GAAG,GAAIC;QAEvE,IAAI,CAACN,SAASO,eAAe;YAC5B,OAAOT,YAAYU,KAAK,CAAC;gBACxBC,SAAS;gBACTC,OAAO;oBAAC;iBAAY;YACrB;QACD;QAEA,MAAMC,QAAQ,MAAMC,IAAAA,6BAAmB;QACvC,MAAMC,cAAcF,MAAMG,cAAc;QACxCD,YAAYE,eAAe,CAACC,SAAS,GAAGhB,QAAQM,EAAE;QAClD,MAAMK,MAAMM,eAAe,CAACJ;QAE5B,MAAMf,YAAYoB,MAAM,CAAE,MAAM,IAAI,CAACC,wBAAwB,CAACC,KAAK,CAAC;YAAEC,SAAS;QAAoB;IACpG;IAEA,MAAMC,sBAAsB;QAC3B,MAAMX,QAAQ,MAAMC,IAAAA,6BAAmB;QACvC,MAAMC,cAAcF,MAAMG,cAAc;QAExC,MAAMS,aAAa,IAAIC,iCAAwB,GAC7CC,WAAW,CAAC,CAAC,gCAAgC,CAAC,EAC9CC,cAAc,CAAC,yDACfC,YAAY,CAAC,GACbC,YAAY,CAAC;QAEf,MAAMC,qBAAqB;QAC3B,IAAIhB,YAAYE,eAAe,CAACC,SAAS,EAAE;YAC1C,MAAMhB,UAAW,MAAM,IAAI,CAAC8B,MAAM,CAAC5B,QAAQ,CACzC6B,KAAK,CAAClB,YAAYE,eAAe,CAACC,SAAS,EAC3CgB,KAAK,CAAC,IAAM;YACd,IAAIhC,SAAS;gBACZuB,WAAWG,cAAc,CAAC,CAAC,sBAAsB,EAAE1B,QAAQiC,IAAI,EAAE;YAClE,OAAOV,WAAWG,cAAc,CAACG;QAClC,OAAO;YACNN,WAAWG,cAAc,CAACG;QAC3B;QAEA,OAAO,IAAIK,yBAAgB,GAA6BC,aAAa,CAACZ;IACvE;IAnDA,YACC,AACiBJ,wBAA+D,EAChF,AAAiCW,MAAc,CAC9C;aAFgBX,2BAAAA;aACgBW,SAAAA;IAC/B;AAgDJ;;;;;;;;;;;;;;iEAnD2BM,kDAAwB"}