{"version":3,"sources":["../../../../../../src/bot/roles-settings/commands/configure-roles/components/_build-role-configure.ts"],"sourcesContent":["import { forwardRef, Inject, Injectable } from \"@nestjs/common\";\r\nimport { Modal, Context, SlashCommand, SlashCommandContext, Ctx, ModalContext } from \"necord\";\r\nimport {\r\n\tActionRowBuilder,\r\n\tCacheType,\r\n\tChatInputCommandInteraction,\r\n\tClient,\r\n\tEmbedBuilder,\r\n\tInteractionReplyOptions,\r\n\tInteractionResponse,\r\n\tMessagePayload,\r\n\tModalActionRowComponentBuilder,\r\n\tModalBuilder,\r\n\tModalSubmitInteraction,\r\n\tTextInputBuilder,\r\n\tTextInputStyle,\r\n} from \"discord.js\";\r\nimport { BotConfig } from \"@/config\";\r\nimport { ProductProps } from \"@/@shared/sharpify/api\";\r\nimport { dotEnv, formatPrice } from \"@/@shared/lib\";\r\nimport TurndownService from \"turndown\";\r\nimport { SelectRole } from \"./select-role\";\r\nimport { getLocalStoreConfig } from \"@/@shared/sharpify\";\r\nimport { RemoveAllRolesComponent } from \"./remove-all-roles.button\";\r\n\r\n@Injectable()\r\nexport class BuildRoleConfigure {\r\n\tconstructor(\r\n\t\t@Inject(forwardRef(() => SelectRole))\r\n\t\tprivate readonly selectRole: SelectRole,\r\n\t\t@Inject(forwardRef(() => RemoveAllRolesComponent))\r\n\t\tprivate readonly removeAllRolesComponent: RemoveAllRolesComponent,\r\n\t\t@Inject(Client) private readonly client: Client,\r\n\t) {}\r\n\r\n\tasync build(): Promise<string | InteractionReplyOptions | MessagePayload> {\r\n\t\tconst roles = await this.client.guilds.fetch(dotEnv.DISCORD_GUILD_ID).then((guild) => guild.roles.fetch());\r\n\r\n\t\tconst emmbed = new EmbedBuilder()\r\n\t\t\t.setColor(BotConfig.color)\r\n\t\t\t.setTitle(\"Configuração de Cargos por apos a compra\")\r\n\t\t\t.setDescription(\r\n\t\t\t\t\"Quando um membro realizar uma compra aqui pelo discord ou fazer uma compra estando logado pelo site usando o discord, ele receberá automaticamente os cargos configurados aqui!\",\r\n\t\t\t);\r\n\r\n\t\tconst store = await getLocalStoreConfig();\r\n\r\n\t\tfor (const role of roles.values()) {\r\n\t\t\tconst hasRoleInStore = store.applyRolesSettings?.some((r) => r.roleId === role.id);\r\n\t\t\tif (!hasRoleInStore) continue;\r\n\t\t\temmbed.addFields({\r\n\t\t\t\tname: role.name,\r\n\t\t\t\tvalue: `\\`${role.id}\\``,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst { RemoveAllRolesButton } = await this.removeAllRolesComponent.createButton();\r\n\r\n\t\treturn {\r\n\t\t\tembeds: [emmbed],\r\n\t\t\tcomponents: [\r\n\t\t\t\tthis.selectRole.createSelectChannel({}),\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: 1,\r\n\t\t\t\t\tcomponents: [RemoveAllRolesButton],\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\tflags: [\"Ephemeral\"],\r\n\t\t};\r\n\t}\r\n}\r\n"],"names":["BuildRoleConfigure","build","roles","client","guilds","fetch","dotEnv","DISCORD_GUILD_ID","then","guild","emmbed","EmbedBuilder","setColor","BotConfig","color","setTitle","setDescription","store","getLocalStoreConfig","role","values","hasRoleInStore","applyRolesSettings","some","r","roleId","id","addFields","name","value","RemoveAllRolesButton","removeAllRolesComponent","createButton","embeds","components","selectRole","createSelectChannel","type","flags","SelectRole","RemoveAllRolesComponent"],"mappings":";;;;+BA0BaA;;;eAAAA;;;wBA1BkC;yBAgBxC;wBACmB;qBAEU;4BAET;0BACS;sCACI;;;;;;;;;;;;;;;AAGjC,IAAA,AAAMA,qBAAN,MAAMA;IASZ,MAAMC,QAAoE;QACzE,MAAMC,QAAQ,MAAM,IAAI,CAACC,MAAM,CAACC,MAAM,CAACC,KAAK,CAACC,WAAM,CAACC,gBAAgB,EAAEC,IAAI,CAAC,CAACC,QAAUA,MAAMP,KAAK,CAACG,KAAK;QAEvG,MAAMK,SAAS,IAAIC,qBAAY,GAC7BC,QAAQ,CAACC,iBAAS,CAACC,KAAK,EACxBC,QAAQ,CAAC,4CACTC,cAAc,CACd;QAGF,MAAMC,QAAQ,MAAMC,IAAAA,6BAAmB;QAEvC,KAAK,MAAMC,QAAQjB,MAAMkB,MAAM,GAAI;YAClC,MAAMC,iBAAiBJ,MAAMK,kBAAkB,EAAEC,KAAK,CAACC,IAAMA,EAAEC,MAAM,KAAKN,KAAKO,EAAE;YACjF,IAAI,CAACL,gBAAgB;YACrBX,OAAOiB,SAAS,CAAC;gBAChBC,MAAMT,KAAKS,IAAI;gBACfC,OAAO,CAAC,EAAE,EAAEV,KAAKO,EAAE,CAAC,EAAE,CAAC;YACxB;QACD;QAEA,MAAM,EAAEI,oBAAoB,EAAE,GAAG,MAAM,IAAI,CAACC,uBAAuB,CAACC,YAAY;QAEhF,OAAO;YACNC,QAAQ;gBAACvB;aAAO;YAChBwB,YAAY;gBACX,IAAI,CAACC,UAAU,CAACC,mBAAmB,CAAC,CAAC;gBACrC;oBACCC,MAAM;oBACNH,YAAY;wBAACJ;qBAAqB;gBACnC;aACA;YACDQ,OAAO;gBAAC;aAAY;QACrB;IACD;IA1CA,YACC,AACiBH,UAAsB,EACvC,AACiBJ,uBAAgD,EACjE,AAAiC5B,MAAc,CAC9C;aAJgBgC,aAAAA;aAEAJ,0BAAAA;aACgB5B,SAAAA;IAC/B;AAqCJ;;;iEA1C2BoC,sBAAU;iEAEVC,6CAAuB"}