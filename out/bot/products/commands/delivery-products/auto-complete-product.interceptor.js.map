{"version":3,"sources":["../../../../../src/bot/products/commands/delivery-products/auto-complete-product.interceptor.ts"],"sourcesContent":["import { FindEmojiHelper } from \"@/@shared/helpers\";\r\nimport { formatPrice } from \"@/@shared/lib\";\r\nimport { Sharpify } from \"@/@shared/sharpify\";\r\nimport { ProductProps } from \"@/@shared/sharpify/api\";\r\nimport { ConsoleLogger, Injectable } from \"@nestjs/common\";\r\nimport { AutocompleteInteraction } from \"discord.js\";\r\nimport { AutocompleteInterceptor } from \"necord\";\r\n\r\n@Injectable()\r\nexport class ProductAutocompleteInterceptor extends AutocompleteInterceptor {\r\n\tpublic async transformOptions(interaction: AutocompleteInteraction) {\r\n\t\tconst focused = interaction.options.getFocused(true);\r\n\r\n\t\tif (focused.name !== \"titulo\") return;\r\n\r\n\t\tconst req = await Sharpify.api.v1.catalog.product.list({\r\n\t\t\tlimit: 10,\r\n\t\t\tpage: 1,\r\n\t\t\ttitle: focused.value.toString(),\r\n\t\t\tproductItemTitle: focused.value.toString(),\r\n\t\t});\r\n\t\tif (!req.success)\r\n\t\t\treturn interaction.respond([\r\n\t\t\t\t{\r\n\t\t\t\t\tname: `Error ao buscar produtos: ${req.errorName}`,\r\n\t\t\t\t\tvalue: \"0\",\r\n\t\t\t\t},\r\n\t\t\t]);\r\n\r\n\t\tconst productItems: { product: ProductProps; item: ProductProps.ProductItem }[] = [];\r\n\r\n\t\tfor (const product of req.data.products) {\r\n\t\t\tif (product.settings.viewType === \"NORMAL\") {\r\n\t\t\t\tproductItems.push({ product, item: product.normalItem });\r\n\t\t\t} else {\r\n\t\t\t\tproductItems.push(...product.dynamicItems.map((item) => ({ product, item })));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn interaction.respond(\r\n\t\t\tproductItems\r\n\t\t\t\t.filter(({ item, product }) => {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\tproduct.info.title?.toLowerCase()?.includes(focused.value.toString().toLowerCase()) ||\r\n\t\t\t\t\t\titem.info.title?.toLowerCase()?.includes(focused.value.toString().toLowerCase())\r\n\t\t\t\t\t);\r\n\t\t\t\t})\r\n\t\t\t\t.map(({ item, product }) => {\r\n\t\t\t\t\tlet title =\r\n\t\t\t\t\t\tproduct.settings.viewType === \"NORMAL\"\r\n\t\t\t\t\t\t\t? product.info.title\r\n\t\t\t\t\t\t\t: `${product.info.title} ‚û°Ô∏è ${item.info.title}`;\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tname: `${title.slice(0, 50)}  |  ${formatPrice(item.pricing.price)} | üì¶ ${item.inventory.stockQuantity === null ? \"Estoque ilimitado\" : `${item.inventory.stockQuantity} em estoque`}`,\r\n\t\t\t\t\t\tvalue: `${product.id}:${item.id}`,\r\n\t\t\t\t\t};\r\n\t\t\t\t}),\r\n\t\t);\r\n\t}\r\n}\r\n"],"names":["ProductAutocompleteInterceptor","AutocompleteInterceptor","transformOptions","interaction","focused","options","getFocused","name","req","Sharpify","api","v1","catalog","product","list","limit","page","title","value","toString","productItemTitle","success","respond","errorName","productItems","data","products","settings","viewType","push","item","normalItem","dynamicItems","map","filter","info","toLowerCase","includes","slice","formatPrice","pricing","price","inventory","stockQuantity","id"],"mappings":";;;;+BASaA;;;eAAAA;;;qBARe;0BACH;wBAEiB;wBAEF;;;;;;;AAGjC,IAAA,AAAMA,iCAAN,MAAMA,uCAAuCC,+BAAuB;IAC1E,MAAaC,iBAAiBC,WAAoC,EAAE;QACnE,MAAMC,UAAUD,YAAYE,OAAO,CAACC,UAAU,CAAC;QAE/C,IAAIF,QAAQG,IAAI,KAAK,UAAU;QAE/B,MAAMC,MAAM,MAAMC,kBAAQ,CAACC,GAAG,CAACC,EAAE,CAACC,OAAO,CAACC,OAAO,CAACC,IAAI,CAAC;YACtDC,OAAO;YACPC,MAAM;YACNC,OAAOb,QAAQc,KAAK,CAACC,QAAQ;YAC7BC,kBAAkBhB,QAAQc,KAAK,CAACC,QAAQ;QACzC;QACA,IAAI,CAACX,IAAIa,OAAO,EACf,OAAOlB,YAAYmB,OAAO,CAAC;YAC1B;gBACCf,MAAM,CAAC,0BAA0B,EAAEC,IAAIe,SAAS,EAAE;gBAClDL,OAAO;YACR;SACA;QAEF,MAAMM,eAA4E,EAAE;QAEpF,KAAK,MAAMX,WAAWL,IAAIiB,IAAI,CAACC,QAAQ,CAAE;YACxC,IAAIb,QAAQc,QAAQ,CAACC,QAAQ,KAAK,UAAU;gBAC3CJ,aAAaK,IAAI,CAAC;oBAAEhB;oBAASiB,MAAMjB,QAAQkB,UAAU;gBAAC;YACvD,OAAO;gBACNP,aAAaK,IAAI,IAAIhB,QAAQmB,YAAY,CAACC,GAAG,CAAC,CAACH,OAAU,CAAA;wBAAEjB;wBAASiB;oBAAK,CAAA;YAC1E;QACD;QAEA,OAAO3B,YAAYmB,OAAO,CACzBE,aACEU,MAAM,CAAC,CAAC,EAAEJ,IAAI,EAAEjB,OAAO,EAAE;YACzB,OACCA,QAAQsB,IAAI,CAAClB,KAAK,EAAEmB,eAAeC,SAASjC,QAAQc,KAAK,CAACC,QAAQ,GAAGiB,WAAW,OAChFN,KAAKK,IAAI,CAAClB,KAAK,EAAEmB,eAAeC,SAASjC,QAAQc,KAAK,CAACC,QAAQ,GAAGiB,WAAW;QAE/E,GACCH,GAAG,CAAC,CAAC,EAAEH,IAAI,EAAEjB,OAAO,EAAE;YACtB,IAAII,QACHJ,QAAQc,QAAQ,CAACC,QAAQ,KAAK,WAC3Bf,QAAQsB,IAAI,CAAClB,KAAK,GAClB,GAAGJ,QAAQsB,IAAI,CAAClB,KAAK,CAAC,IAAI,EAAEa,KAAKK,IAAI,CAAClB,KAAK,EAAE;YACjD,OAAO;gBACNV,MAAM,GAAGU,MAAMqB,KAAK,CAAC,GAAG,IAAI,KAAK,EAAEC,IAAAA,gBAAW,EAACT,KAAKU,OAAO,CAACC,KAAK,EAAE,MAAM,EAAEX,KAAKY,SAAS,CAACC,aAAa,KAAK,OAAO,sBAAsB,GAAGb,KAAKY,SAAS,CAACC,aAAa,CAAC,WAAW,CAAC,EAAE;gBACvLzB,OAAO,GAAGL,QAAQ+B,EAAE,CAAC,CAAC,EAAEd,KAAKc,EAAE,EAAE;YAClC;QACD;IAEH;AACD"}