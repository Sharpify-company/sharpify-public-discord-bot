{"version":3,"sources":["../../src/workers/revalidate-store-config.worker.ts"],"sourcesContent":["import { ExternalEventsEntity, OrderEntity, StoreConfigEntity } from \"@/@shared/db/entities\";\r\nimport { Sharpify } from \"@/@shared/sharpify\";\r\nimport { Injectable, OnModuleInit } from \"@nestjs/common\";\r\nimport { Cron } from \"@nestjs/schedule\";\r\nimport { HandleProductEvent } from \"./usecases\";\r\n\r\n@Injectable()\r\nexport class RevalidateStoreConfigWorker {\r\n\r\n\t@Cron(\"0 * * * * *\")\r\n\thandleCron() {\r\n\t\tthis.execute();\r\n\t}\r\n\r\n\tasync execute() {\r\n\t\tconst getStoreReq = await Sharpify.api.v1.management.store.getStore();\r\n\t\tif (!getStoreReq.success) return console.error(\"Revalidar configuração da loja falhou:\", getStoreReq.errorName);\r\n\r\n\t\tlet storeConfigEntity = await StoreConfigEntity.findOneBy({ id: \"DEFAULT\" });\r\n\t\tif (!storeConfigEntity) await StoreConfigEntity.createStore(getStoreReq.data).save();\r\n\t\telse await storeConfigEntity.updateProps(getStoreReq.data);\r\n\t}\r\n}\r\n"],"names":["RevalidateStoreConfigWorker","handleCron","execute","getStoreReq","Sharpify","api","v1","management","store","getStore","success","console","error","errorName","storeConfigEntity","StoreConfigEntity","findOneBy","id","createStore","data","save","updateProps"],"mappings":";;;;+BAOaA;;;eAAAA;;;0BAPwD;0BAC5C;wBACgB;0BACpB;;;;;;;;;;AAId,IAAA,AAAMA,8BAAN,MAAMA;IAGZC,aAAa;QACZ,IAAI,CAACC,OAAO;IACb;IAEA,MAAMA,UAAU;QACf,MAAMC,cAAc,MAAMC,kBAAQ,CAACC,GAAG,CAACC,EAAE,CAACC,UAAU,CAACC,KAAK,CAACC,QAAQ;QACnE,IAAI,CAACN,YAAYO,OAAO,EAAE,OAAOC,QAAQC,KAAK,CAAC,0CAA0CT,YAAYU,SAAS;QAE9G,IAAIC,oBAAoB,MAAMC,2BAAiB,CAACC,SAAS,CAAC;YAAEC,IAAI;QAAU;QAC1E,IAAI,CAACH,mBAAmB,MAAMC,2BAAiB,CAACG,WAAW,CAACf,YAAYgB,IAAI,EAAEC,IAAI;aAC7E,MAAMN,kBAAkBO,WAAW,CAAClB,YAAYgB,IAAI;IAC1D;AACD"}