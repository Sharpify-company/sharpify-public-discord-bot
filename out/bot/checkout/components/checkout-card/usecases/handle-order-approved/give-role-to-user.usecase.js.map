{"version":3,"sources":["../../../../../../../src/bot/checkout/components/checkout-card/usecases/handle-order-approved/give-role-to-user.usecase.ts"],"sourcesContent":["import { getLocalStoreConfig, Sharpify } from \"@/@shared/sharpify\";\r\nimport {\r\n\tActionRowBuilder,\r\n\tButtonBuilder,\r\n\tButtonInteraction,\r\n\tButtonStyle,\r\n\tCacheType,\r\n\tChannelType,\r\n\tClient,\r\n\tEmbedBuilder,\r\n\tPermissionsBitField,\r\n} from \"discord.js\";\r\nimport { dotEnv } from \"@/@shared/lib\";\r\n\r\nimport { ValidateDatabaseCartItemsHelper } from \"@/bot/checkout/helpers\";\r\nimport { Inject, Injectable } from \"@nestjs/common\";\r\nimport { DiscordUserEntity, OrderEntity } from \"@/@shared/db/entities\";\r\nimport { get } from \"http\";\r\n\r\n@Injectable()\r\nexport class GiveRoleToUserUsecase {\r\n\tconstructor(\r\n\t\t@Inject(Client) private readonly client: Client,\r\n\t) {}\r\n\r\n\r\n\tasync execute({ discordUserId }: GiveRoleToUserUsecase.Input) {\r\n\t\tconst guild = await this.client.guilds.fetch(process.env.DISCORD_GUILD_ID!).catch(() => null);\r\n\t\tif (!guild) return;\r\n\r\n\t\tconst member = await guild.members.fetch(discordUserId).catch(() => null);\r\n\t\tif (!member) return;\r\n\r\n\t\tconst store = await getLocalStoreConfig();\r\n\t\tconst rolesToGive = store?.applyRolesSettings || [];\r\n\t\tfor (const roleToGive of rolesToGive) {\r\n\t\t\tconst role = await guild.roles.fetch(roleToGive.roleId).catch(() => null);\r\n\t\t\tif (!role) continue;\r\n\t\t\tconst result = await member.roles.add(role).catch((err) => {\r\n\t\t\t\tconsole.log(err);\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport namespace GiveRoleToUserUsecase {\r\n\texport interface Input {\r\n\t\tdiscordUserId: string;\r\n\t}\r\n}\r\n"],"names":["GiveRoleToUserUsecase","execute","discordUserId","guild","client","guilds","fetch","process","env","DISCORD_GUILD_ID","catch","member","members","store","getLocalStoreConfig","rolesToGive","applyRolesSettings","roleToGive","role","roles","roleId","result","add","err","console","log"],"mappings":";;;;+BAoBaA;;;eAAAA;;;0BApBiC;yBAWvC;wBAI4B;;;;;;;;;;;;;;;AAK5B,IAAA,AAAMA,wBAAN,MAAMA;IAMZ,MAAMC,QAAQ,EAAEC,aAAa,EAA+B,EAAE;QAC7D,MAAMC,QAAQ,MAAM,IAAI,CAACC,MAAM,CAACC,MAAM,CAACC,KAAK,CAACC,QAAQC,GAAG,CAACC,gBAAgB,EAAGC,KAAK,CAAC,IAAM;QACxF,IAAI,CAACP,OAAO;QAEZ,MAAMQ,SAAS,MAAMR,MAAMS,OAAO,CAACN,KAAK,CAACJ,eAAeQ,KAAK,CAAC,IAAM;QACpE,IAAI,CAACC,QAAQ;QAEb,MAAME,QAAQ,MAAMC,IAAAA,6BAAmB;QACvC,MAAMC,cAAcF,OAAOG,sBAAsB,EAAE;QACnD,KAAK,MAAMC,cAAcF,YAAa;YACrC,MAAMG,OAAO,MAAMf,MAAMgB,KAAK,CAACb,KAAK,CAACW,WAAWG,MAAM,EAAEV,KAAK,CAAC,IAAM;YACpE,IAAI,CAACQ,MAAM;YACX,MAAMG,SAAS,MAAMV,OAAOQ,KAAK,CAACG,GAAG,CAACJ,MAAMR,KAAK,CAAC,CAACa;gBAClDC,QAAQC,GAAG,CAACF;gBACZ,OAAO;YACR;QACD;IACD;IAtBA,YACC,AAAiCnB,MAAc,CAC9C;aADgCA,SAAAA;IAC/B;AAqBJ"}