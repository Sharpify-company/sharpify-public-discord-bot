{"version":3,"sources":["../../src/bot/emoji.service.ts"],"sourcesContent":["import { dotEnv } from \"@/@shared/lib\";\r\nimport { Injectable, Logger } from \"@nestjs/common\";\r\nimport { Once, Context, ContextOf } from \"necord\";\r\nimport path from \"path\";\r\nimport * as fs from \"fs\";\r\nimport { EmojiEntity } from \"@/@shared/db/entities\";\r\n\r\n@Injectable()\r\nexport class EmojiService {\r\n\t@Once(\"clientReady\")\r\n\tpublic async onReady(@Context() [client]: ContextOf<\"ready\">) {\r\n\t\tconst application = await client.application.fetch().catch(() => null);\r\n\t\tif (!application) return console.log(\"Guild não encontrado.\");\r\n\r\n\t\tconst emojiDir = path.join(process.cwd(), \"assets\", \"emojis\");\r\n\t\tif (!fs.existsSync(emojiDir)) {\r\n\t\t\tconsole.error(\"❌ Pasta de emojis não encontrada:\", emojiDir);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst files = fs.readdirSync(emojiDir).filter((file) => /\\.(png|jpg|jpeg|gif)$/i.test(file));\r\n\r\n\t\tconst AllEmojis = await application.emojis.fetch();\r\n\r\n\t\tfor (const file of files) {\r\n\t\t\tconst emojiName = `Sharpify_${path.parse(file).name}`;\r\n\r\n\t\t\tconst existsOnDb = await EmojiEntity.findOneBy({ name: emojiName as any });\r\n\t\t\tif (existsOnDb) continue;\r\n\r\n\t\t\tconst filePath = path.join(emojiDir, file);\r\n\t\t\ttry {\r\n\t\t\t\tconst emoji = await application.emojis.create({\r\n\t\t\t\t\tname: emojiName,\r\n\t\t\t\t\tattachment: filePath,\r\n\t\t\t\t});\r\n\r\n\t\t\t\tawait EmojiEntity.createEmoji({\r\n\t\t\t\t\tid: emoji.id,\r\n\t\t\t\t\tname: emoji.name,\r\n\t\t\t\t}).save();\r\n\r\n\t\t\t\tconsole.log(`✅ Emoji criado: ${emoji.name}`);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tif ((err as any).code === 50035) {\r\n\t\t\t\t\tconst emojiExists = AllEmojis.find((e) => e.name === emojiName);\r\n\t\t\t\t\tif (emojiExists) {\r\n\t\t\t\t\t\tawait EmojiEntity.createEmoji({\r\n\t\t\t\t\t\t\tid: emojiExists.id,\r\n\t\t\t\t\t\t\tname: emojiExists.name,\r\n\t\t\t\t\t\t}).save();\r\n\t\t\t\t\t\tconsole.log(`⚙️ Emoji '${emojiName}' já existe (erro capturado), salvando no banco de dados.`);\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconsole.log(`⚙️ Emoji '${emojiName}' já existe (erro capturado), pulando.`);\r\n\t\t\t\t} else console.error(`❌ Erro ao criar emoji '${emojiName}':`, JSON.stringify(err));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n"],"names":["EmojiService","onReady","client","application","fetch","catch","console","log","emojiDir","path","join","process","cwd","fs","existsSync","error","files","readdirSync","filter","file","test","AllEmojis","emojis","emojiName","parse","name","existsOnDb","EmojiEntity","findOneBy","filePath","emoji","create","attachment","createEmoji","id","save","err","code","emojiExists","find","e","JSON","stringify"],"mappings":";;;;+BAQaA;;;eAAAA;;;wBAPsB;wBACM;6DACxB;4DACG;0BACQ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGrB,IAAA,AAAMA,eAAN,MAAMA;IACZ,MACaC,QAAQ,AAAW,CAACC,OAA2B,EAAE;QAC7D,MAAMC,cAAc,MAAMD,OAAOC,WAAW,CAACC,KAAK,GAAGC,KAAK,CAAC,IAAM;QACjE,IAAI,CAACF,aAAa,OAAOG,QAAQC,GAAG,CAAC;QAErC,MAAMC,WAAWC,aAAI,CAACC,IAAI,CAACC,QAAQC,GAAG,IAAI,UAAU;QACpD,IAAI,CAACC,IAAGC,UAAU,CAACN,WAAW;YAC7BF,QAAQS,KAAK,CAAC,qCAAqCP;YACnD;QACD;QAEA,MAAMQ,QAAQH,IAAGI,WAAW,CAACT,UAAUU,MAAM,CAAC,CAACC,OAAS,yBAAyBC,IAAI,CAACD;QAEtF,MAAME,YAAY,MAAMlB,YAAYmB,MAAM,CAAClB,KAAK;QAEhD,KAAK,MAAMe,QAAQH,MAAO;YACzB,MAAMO,YAAY,CAAC,SAAS,EAAEd,aAAI,CAACe,KAAK,CAACL,MAAMM,IAAI,EAAE;YAErD,MAAMC,aAAa,MAAMC,qBAAW,CAACC,SAAS,CAAC;gBAAEH,MAAMF;YAAiB;YACxE,IAAIG,YAAY;YAEhB,MAAMG,WAAWpB,aAAI,CAACC,IAAI,CAACF,UAAUW;YACrC,IAAI;gBACH,MAAMW,QAAQ,MAAM3B,YAAYmB,MAAM,CAACS,MAAM,CAAC;oBAC7CN,MAAMF;oBACNS,YAAYH;gBACb;gBAEA,MAAMF,qBAAW,CAACM,WAAW,CAAC;oBAC7BC,IAAIJ,MAAMI,EAAE;oBACZT,MAAMK,MAAML,IAAI;gBACjB,GAAGU,IAAI;gBAEP7B,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAEuB,MAAML,IAAI,EAAE;YAC5C,EAAE,OAAOW,KAAK;gBACb,IAAI,AAACA,IAAYC,IAAI,KAAK,OAAO;oBAChC,MAAMC,cAAcjB,UAAUkB,IAAI,CAAC,CAACC,IAAMA,EAAEf,IAAI,KAAKF;oBACrD,IAAIe,aAAa;wBAChB,MAAMX,qBAAW,CAACM,WAAW,CAAC;4BAC7BC,IAAII,YAAYJ,EAAE;4BAClBT,MAAMa,YAAYb,IAAI;wBACvB,GAAGU,IAAI;wBACP7B,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAEgB,UAAU,yDAAyD,CAAC;wBAC7F;oBACD;oBAEAjB,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAEgB,UAAU,sCAAsC,CAAC;gBAC3E,OAAOjB,QAAQS,KAAK,CAAC,CAAC,uBAAuB,EAAEQ,UAAU,EAAE,CAAC,EAAEkB,KAAKC,SAAS,CAACN;YAC9E;QACD;IACD;AACD"}